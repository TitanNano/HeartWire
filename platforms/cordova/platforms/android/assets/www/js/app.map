{"version":3,"sources":["webpack:///webpack/bootstrap af37ef3833542dcbf8fd","webpack:///./src/js/bootstrap.js","webpack:///./src/js/main.js","webpack:///./src/af/util/make.js","webpack:///./src/js/Account.js","webpack:///./src/af/core/prototypes/EventTarget.js","webpack:///./src/js/ScreenManager.js","webpack:///./src/js/Storage.js","webpack:///./src/af/modules/IndexedDB.js","webpack:///./src/af/modules/IndexedDB/IndexedQueryCompiler.js","webpack:///./src/af/core/objects/ArrayUtil.js","webpack:///./src/af/core/prototypes/Application.js","webpack:///./src/af/core/prototypes/Thread.js","webpack:///./src/af/core/objects/Shared.js","webpack:///./src/af/core/prototypes/ApplicationInternal.js","webpack:///./src/js/ChatView.js","webpack:///./src/js/BottomInput.js","webpack:///./src/af/modules/DataBinding.js","webpack:///./src/af/modules/DataBinding/Template.js","webpack:///./src/af/modules/DataBinding/Bind.js","webpack:///./src/af/modules/DataBinding/Parser.js","webpack:///./src/af/modules/DataBinding/Mapping.js","webpack:///./src/af/modules/DataBinding/Util.js","webpack:///./src/af/modules/DataBinding/AutoBinding.js","webpack:///./src/af/modules/DataBinding/Binding.js","webpack:///./src/af/modules/DataBinding/BindingRegistry.js","webpack:///./src/af/modules/DataBinding/ClassBinding.js","webpack:///./src/af/modules/DataBinding/RenderEngine.js","webpack:///./src/af/modules/DataBinding/RenderEngine/TaskList.js","webpack:///./src/af/modules/DataBinding/EnabledBinding.js","webpack:///./src/af/modules/DataBinding/ScopePrototype.js","webpack:///./src/af/modules/DataBinding/StyleBinding.js","webpack:///./src/af/modules/DataBinding/TemplateRepeatBinding.js","webpack:///./src/af/modules/DataBinding/TwoWayBinding.js","webpack:///./src/af/modules/DataBinding/TemplateLoader.js","webpack:///./src/af/core/prototypes/NetworkRequest.js","webpack:///./src/af/modules/DataBinding/ViewPort.js","webpack:///./src/af/modules/DataBinding/IfBinding.js","webpack:///./src/af/modules/DataBinding/ElementToScopeBinding.js","webpack:///./src/af/modules/DataBinding/AttributeBinding.js","webpack:///./src/js/Header.js","webpack:///./src/js/ViewController.js","webpack:///./src/js/MessageList.js","webpack:///./src/js/MessageManager.js","webpack:///./src/js/CappedArray.js","webpack:///./src/js/CryptoProxy.js","webpack:///./src/af/modules/sha-256.js","webpack:///./src/af/modules/sha-1.js","webpack:///./src/js/Message.js","webpack:///./src/js/LoginDialog.js","webpack:///./src/js/PushManager.js","webpack:///./src/js/Socket.js","webpack:///./src/af/modules/uuid.js","webpack:///./src/js/SyncDialog.js"],"names":["onDeviceReady","init","deviceReady","Promise","ready","window","cordova","document","addEventListener","readyState","polymerReady","Polymer","ImportStatus","_ready","whenReady","all","then","application","Object","create","name","socket","headerController","bottomInputController","messageListController","loginDialog","storage","constructor","sreeenManager","host","account","chatView","syncDialog","__proto__","apply","target","source","keys","forEach","key","defineProperty","getOwnPropertyDescriptor","Make","object","prototype","arguments","length","m","make","_make","args","get","hasPrototype","p","getPrototypeOf","undefined","Mixin","prototypes","Proxy","MixinTrap","findProperty","i","item","bind","value","Account","_socket","_userData","_partnerData","credentialsReady","busy","lastError","isReady","partner","id","_id","color","_credentials","username","password","getUserDataByUserName","user","emit","connected","_socketConnected","on","_userIsOnline","_userIsAway","_loadPartner","getUserDataById","sendMessage","data","setUserData","response","error","reject","_authSuccess","catch","_authError","wasReady","console","log","applicationIsActive","JSON","stringify","_listeners","authenticated","reason","localStorage","removeItem","disconnect","userData","authenticate","btoa","setItem","getItem","setSyncChallenge","syncChallenge","e","checkSyncChanllenge","getPartner","EventTarget","type","listener","push","setTimeout","ScreenManager","hidden","db","MAGIC_CHUNK_SIZE","define","store","keyPath","unique","index","Storage","getMessages","userId","afterMessageId","read","where","equals","or","to","sort","lowerThan","userName","write","storeMessage","message","IndexedStoreDefinition","indexes","info","description","IndexedDefinition","_version","_currentStore","_allStores","version","members","options","_execute","transaction","objectStore","storeDefinition","createObjectStore","createIndex","deleteIndex","IndexedDB","_name","_definitions","_setup","success","failure","request","indexedDB","open","onsuccess","event","result","onerror","onupgradeneeded","lastVersion","oldVersion","setup","_promise","storeName","put","IndexedQuery","rangeStart","rangeEnd","IndexedQueryCompiler","_currentQuery","_allQueries","_store","_db","sortOrder","_transformExclude","exclude","Array","isArray","map","indexName","from","assignEmpty","higherThan","direction","limit","unshift","start","end","matches","results","done","range","rangeArray","query","IDBKeyRange","bound","lowerBound","upperBound","openCursor","cursor","indexOf","primaryKey","doesMatch","keyCount","continue","ArrayUtil","sources","Internal","WeakMap","Application","author","set","scope","listeners","removeListener","splice","f","thread","workers","terminate","Thread","parent","_thread","Worker","threadLoader","postMessage","func","progressListeners","ApplicationInternal","modules","ChatView","_app","header","messageList","bottomInput","isVisible","isNotVisible","app","_scope","makeTemplate","view","subscribe","BottomInput","currentDraft","inputValue","replace","inputFocused","usePlaceholderClass","inputElement","inputFocusChange","cancleRecycle","__apply__","NodeList","NamedNodeMap","style","createElement","innerHTML","head","appendChild","DataBinding","bindNode","ViewPort","makeElementFromTemplate","template","schedulePostRenderTask","node","importNode","content","placeholder","querySelector","attributes","firstElementChild","setAttribute","attr","parentNode","replaceChild","children","className","search","hasAttribute","element","parentScope","processed","getAttribute","makeElement","list","querySelectorAll","MutationObserver","mutations","addedNodes","slice","reduce","prev","next","concat","filter","localName","observe","body","childList","subtree","isReplace","isInsert","elementList","childNodes","__cleanElements__","removeChild","parentName","insertBefore","scopeList","Map","scopeIndex","watcherList","expressionTracking","isolated","Node","bindings","checkNode","recycle","dataRegex","scopeInfo","nodeName","nodeType","text","textContent","variables","match","visibilityBinding","transparencyBinding","enabledAttribute","classes","modelBinding","autoBinding","twoWay","styleBinding","singleBinding","bindTwoWay","bindClasses","bindEnabled","bindAuto","bindStyle","test","bindSimple","repeatedTemplate","child","bindTemplateRepeat","events","bindEvents","removeAttribute","indirect","property","split","viewBinding","eventBinding","preventDefault","debounce","binding","properties","originalNodeValue","currentValue","clearTimeout","compareTwoWay","getElementValue","newValue","singleExpression","marker","createComment","method","modifier","$methods","trim","canceled","scopeName","executeWatchers","watcher","expression","cb","scheduleRenderTask","t0","performance","now","update","expr","t1","duration","toFixed","destoryScope","inProgress","scopes","destory","scopes_add","bindings_add","delete","ObjectParser","keyBuffer","valueBuffer","run","char","parseExpression","contexts","chain","functionTest","pos","scopeChild","substring","arg","assignExpression","attributeNames","visible","transparent","prefix","enabled","model","modelEvent","rename","selectElement","context","polyMask","selectAllElements","nodeList","unwrapPolymerNode","polyNode","additions","bare","dom","polyInvoke","getPolyParent","AutoBinding","_isBound","subScope","scopeHolder","scopeObjName","lastIndexOf","pop","join","__destroy__","Binding","localNode","values","pair","toString","Attr","registry","BindingRegistry","register","warn","ClassBinding","applyClass","substr","classList","add","remove","parse","preRenderHooks","postRenderHooks","preRenderTasks","renderTasks","postRenderTasks","nextPostRenderTasks","active","renderCycle","hook","task","tasks","flush","scheduleNextFrame","requestAnimationFrame","RenderEngine","addPreRenderHook","addPostRenderHook","removePreRenderHook","removePostRenderHook","schedulePreRenderTask","renderFrame","TaskList","registeredIds","EnabledBinding","ScopePrototype","fn","localRecycle","__watch__","has","require","readStyleProperties","container","getComputedStyle","dimensions","getBoundingClientRect","styleKey","StyleBinding","TemplateRepeatBinding","itemNodeList","itemScopeList","modelBackup","renderItem","itemName","fragment","polyParent","childScope","$first","$last","$index","__parentScope__","link","dirty","DocumentFragment","nextElementSibling","count","TwoWayBinding","attribute","oldValue","activeElement","createRange","selection","getSelection","selectNodeContents","collapse","removeAllRanges","addRange","importTemplate","send","markup","stripHashKey","NetworkRequest","_body","_headers","url","headers","setHeader","onReady","self","xhr","XMLHttpRequest","promise","onreadystatechange","status","getResponseHeader","setRequestHeader","LIST_HAS_ITEMS","ViewPortInstance","_bound","_innerScope","_originalTemplate","_application","templateUrl","overflow","firstChild","alowOverflow","_elements","getInstance","free","instance","IfBinding","nextSibling","isTrue","ElementToScopeBinding","AttributeBinding","config","attrName","attrValue","attrEnabled","Header","notConnected","isOnline","isConnected","connectionStatus","isConnecting","online","onStatusChange","ViewController","models","MessageList","currentMessages","messages","MessageManager","_loadedMessages","_account","chunk","stackTrace","Error","stack","shift","decryptMessage","_mapMessages","_getLatestMessageId","messageId","_decryptMessages","export","getList","reverse","_loadLatestMessages","_fetchLatestMessages","syncRequired","encryptMessage","preview","CappedArray","capacity","_list","elements","sift","bufferToHex","buffer","byte","CryptoProxy","_cryptoKey","syncing","RAW_CHALLENGE","_checkSync","_partnerStatusChanged","_solveChallenge","challenge","_readStringToBuffer","bufferView","TextEncoder","encode","_readStringFromBuffer","TextDecoder","decode","sync","passphrase","rawMessage","iv","crypto","getRandomValues","Uint8Array","subtle","importKey","encrypt","messageBuffer","_importKey","hashedPassphrase","messageData","atob","decrypt","binaryToHex","Uint32Array","Uint16Array","BYTES_PER_ELEMENT","sha256Native","digest","hashBuffer","uint32","Math","pow","leftRotateBits","amount","hex32Bit","hex64Bit","stringToBuffer","unescape","encodeURIComponent","charCodeAt","sha1","h0","h1","h2","h3","h4","messageLength","byteLength","bufferSize","ArrayBuffer","temp","parseInt","a","b","c","d","k","hashToBuffer","hashString","Message","assign","inOrOut","LoginDialog","userNameField","passwordField","hasError","isOpen","isNotActive","isValid","usernameField","validate","login","getErrorMessage","validationMessage","PushManager","platform","serviceStatus","_newPushHandler","_registerHandler","_handleServiceError","_baiduHandleServiceReady","_register","clientId","_handleMessageError","platformId","navigator","_newMessage","token","_registerServiceSimple","force","registrations","unregister","enpoint","_simpleHandleServiceReady","baiduPush","startWork","onNotificationArrived","mozSetMessageHandler","onPush","_newPusHandler","onRegister","setRegistrationFailed","uuid","Socket","_host","_hostId","_websocket","_online","_connected","_connecting","_stop","_onStatusChange","_decelerate","_decelerateTimeout","_decelerateMaxTimeout","_statusChange","_onceQueue","_connectedHandler","onLine","reconnect","_ack","v5","_onMessage","once","close","decelerate","WebSocket","onopen","onclose","onmessage","UUID_SIZE","ReadBytesOfHexString","_value","readByte","hex8Bit","hex16Bit","hex48Bit","time_low","time_mid","time_hi_and_version","clock_seq","pushToBuffer","namespace","nameValue","namespaceValue","completeValue","uuidBuffer","hash","clock_seq_hi_and_reserved","clock_seq_low","SyncDialog","currentStatus","_syncRequired","_syncStatusChanged","startSync","not"],"mappings":"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","file":"af37ef3833542dcbf8fd.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap af37ef3833542dcbf8fd\n **/","import application from './main.js';\n\nlet onDeviceReady = function() {\n    application.init();\n}\n\n\nlet deviceReady = new Promise((ready) => {\n    if (!!window.cordova) {\n        document.addEventListener('deviceready', ready, false);\n    } else if (document.readyState != 'loading') {\n        onDeviceReady();\n    } else {\n        document.addEventListener('DOMContentLoaded', ready, false);\n    }\n});\n\nlet polymerReady = new Promise((ready) => {\n    if (window.Polymer && window.Polymer.ImportStatus._ready) {\n        window.Polymer.ImportStatus.whenReady(ready);\n    } else {\n        window.addEventListener('WebComponentsReady', ready);\n    }\n});\n\nPromise.all([deviceReady, polymerReady]).then(onDeviceReady);\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/bootstrap.js\n **/","import { Make } from '../af/util/make.js';\nimport Account from './Account.js';\nimport Application from '../af/core/prototypes/Application.js';\nimport ChatView from './ChatView.js';\nimport CryptoProxy from './CryptoProxy.js';\nimport LoginDialog from './LoginDialog.js';\nimport MessageManager from './MessageManager.js';\nimport PushManager from './PushManager.js';\nimport ScreenManager from './ScreenManager.js';\nimport Socket from './Socket.js';\nimport Storage from './Storage.js';\nimport SyncDialog from './SyncDialog.js';\n\nlet application = Object.create({\n    name: 'HeartWire',\n\n    socket: null,\n\n    headerController: null,\n    bottomInputController: null,\n    messageListController: null,\n    loginDialog: null,\n    storage: Storage,\n\n    constructor() {\n        super._make();\n\n        this.sreeenManager = ScreenManager;\n\n        this.socket = Make(Socket)({\n            host: [\n                'ws://localhost:5000/socket',\n                'ws://192.168.44.231:5000/socket',\n                'ws://192.168.178.25:5000/socket',\n            ]\n        });\n\n        this.account = Make(Account)(this.socket);\n\n        this.chatView = Make(ChatView)(this, this.account);\n        this.loginDialog = Make(LoginDialog)(this.account);\n        this.syncDialog = Make(SyncDialog)();\n\n        MessageManager.init(this.account, this.socket);\n\n        return this;\n    },\n\n    init() {\n        PushManager.init();\n        CryptoProxy.init(this.account, this.socket);\n    },\n\n    __proto__: Application,\n\n}).constructor();\n\nexport default application;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/main.js\n **/","/**\n * The make module consits of Make, getPrototypeOf and mixin.\n * See the documentation for each method to see what is does.\n * This module is part of the ApplicationFrame.\n * @module Make\n * @author Jovan Gerodetti\n * @copyright Jovan Gerodetti\n * @version 1.0\n */\n\n\n/**\n * Internal function to apply one objects propteries to a target object.\n *\n * @param {Object} target\n * @param {Object} source\n * @inner\n */\nvar apply = function (target, source) {\n    Object.keys(source).forEach(function(key){\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n\n    return target;\n};\n\n/**\n * Creates a new object with the given prototype.\n * If two arguments are passed in, the properties of the first object will be\n * applied to the new object.\n *\n * @param {Object} object\n * @param {Object} prototype\n * @return {function}\n */\nexport var Make = function(object, prototype) {\n    if(arguments.length < 2){\n        prototype = object;\n        object = null;\n    }\n\n    if (object === null) {\n        object = Object.create(prototype);\n    } else {\n        object = apply(Object.create(prototype), object);\n    }\n\n    var m = function(...args){\n        var make = object.make || object._make ||function(){};\n\n        make.apply(object, args);\n\n        return object;\n    };\n\n    m.get = function(){ return object; };\n\n    return m;\n};\n\n/**\n * This method checks if the given prototype is in the prototype chain of\n * the given target object.\n *\n * @param {Object} object\n * @param {Object} prototype\n * @return {boolean}\n */\nexport var hasPrototype = function(object, prototype){\n    var p = Object.getPrototypeOf(object);\n\n    while(p !== null && p !== undefined){\n        if(typeof prototype == 'function')\n            prototype = prototype.prototype;\n\n        if(p == prototype)\n            return true;\n        else\n            p = Object.getPrototypeOf(p);\n    }\n\n    return false;\n};\n\n/**\n * Creates a new prototype mixing all the given prototypes. Incase two or more\n * prototypes contain the same propterty, the new prototype will return\n * the propterty of the first prototype in the list which contains it.\n *\n * @param {...Object} prototypes - the porotype object to combine\n * @return {Proxy} - the resulting proxy object\n */\nexport var Mixin = function(...prototypes){\n\n    return new Proxy(prototypes, MixinTrap);\n\n};\n\n/**\n * Internal function to find a proptery in a list of prototypes.\n *\n * @param {Object[]} prototypes\n * @param {string} key\n * @return {Object}\n */\nvar findProperty = function(prototypes, key) {\n    for (var i = 0; i < prototypes.length; i++) {\n        var item = prototypes[i];\n\n        if (item && item[key]) {\n            return item;\n        }\n    }\n\n    return undefined;\n};\n\n/**\n * Traps to create a mixin.\n */\nvar MixinTrap = {\n\n    'get' : function(prototypes, key) {\n        var object = findProperty(prototypes, key);\n\n        if (object && typeof object[key] === 'function') {\n            return object[key].bind(object);\n        }\n\n        return (object ? object[key] : null);\n    },\n\n    'set' : function(prototypes, key, value) {\n        var object = findProperty(prototypes, key);\n\n        if (object) {\n            object[key] = value;\n        } else {\n            prototypes[0][key] = value;\n        }\n\n        return true;\n    }\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/util/make.js\n **/","import { Make } from '../af/util/make.js';\nimport EventTarget from '../af/core/prototypes/EventTarget';\nimport ScreenManager from './ScreenManager.js';\nimport Storage from './Storage.js';\n\nconst Account = Make(/** @lends Account# */{\n\n    /**\n     * [_socket description]\n     *\n     * @type {Socket}\n     */\n    _socket: null,\n    _userData: null,\n    _partnerData: null,\n\n    credentialsReady: false,\n    busy: false,\n    lastError: '',\n\n    get isReady() {\n        return !!this._userData;\n    },\n\n    get partner() {\n        return this._userData.partner;\n    },\n\n    get id() {\n        return this._userData._id;\n    },\n\n    get color() {\n        return this._userData && this._userData.color;\n    },\n\n    _make(socket) {\n        EventTarget._make.apply(this);\n\n        let [username, password] = this._credentials;\n\n        this._socket = socket;\n\n        if (username && password) {\n            this.credentialsReady = true;\n            this._socket.init();\n        }\n\n        if (username) {\n            Storage.getUserDataByUserName(username).then(user => {\n                if (user && !this._userData) {\n                    this._userData = user;\n\n                    this.emit('ready');\n                }\n            });\n        }\n\n        this._socket.connected(this._socketConnected.bind(this));\n        ScreenManager.on('active', this._userIsOnline.bind(this));\n        ScreenManager.on('inactive', this._userIsAway.bind(this));\n    },\n\n    _loadPartner() {\n        Storage.getUserDataById(this._userData.partner).then(user => {\n            if (!this._partnerData) {\n                this._partnerData = user;\n                this.emit('change');\n            }\n        });\n\n        this._socket.sendMessage('account.partner').then(({ data: partner }) => {\n            Storage.setUserData(partner);\n            this._partnerData = partner;\n            this.emit('change');\n        });\n    },\n\n    _socketConnected() {\n        let [username, password] = this._credentials;\n\n        if (username && password) {\n            this._socket.sendMessage('authentication', {\n                username: username,\n                password: password\n            })\n            .then(response => {\n                if (response.data.error) {\n                    return Promise.reject(response);\n                } else {\n                    return response;\n                }\n            })\n            .then(this._authSuccess.bind(this))\n            .catch(this._authError.bind(this));\n        }\n    },\n\n    _authSuccess({ data: user }) {\n        let wasReady = !!this._userData;\n        console.log('Account: user ', user, 'sucessfully logged in');\n\n        this._userData = user;\n        this.busy = false;\n\n        Storage.setUserData(user);\n        this._loadPartner();\n\n        if (ScreenManager.applicationIsActive) {\n            this._userIsOnline();\n        }\n\n        this.emit('statusChange');\n        this.emit('change');\n        console.log('account listeners:', JSON.stringify(this._listeners.authenticated));\n        this.emit('authenticated');\n\n        if (!wasReady) {\n            this.emit('ready');\n        }\n    },\n\n    _authError(error) {\n        console.error('login faild! reason:', error.data.reason);\n\n        this.credentialsReady = false;\n        this.busy = false;\n        this.lastError = error.data.reason;\n        window.localStorage.removeItem('heartwire.username');\n        window.localStorage.removeItem('heartwire.password');\n        this._socket.disconnect();\n        this.emit('statusChange');\n    },\n\n    _userIsOnline() {\n        if (this._userData) {\n            this._socket.sendMessage('account.online', true).then(({ data: userData }) => {\n                this._userData = userData;\n            });\n        }\n    },\n\n    _userIsAway() {\n        if (this._userData) {\n            this._socket.sendMessage('account.online', false).then(({ data: userData }) => {\n                this._userData = userData;\n            });\n        }\n    },\n\n    /**\n     * [authenticate description]\n     *\n     * @param  {string} username [description]\n     * @param  {string} password [description]\n     *\n     * @return {Promise}          [description]\n     */\n    authenticate: function(username, password) {\n        password = btoa(password);\n\n        window.localStorage.setItem('heartwire.username', username);\n        window.localStorage.setItem('heartwire.password', password);\n\n        this.credentialsReady = true;\n        this.busy = true;\n        this.lastError = '';\n        this._socket.init();\n    },\n\n    get _credentials() {\n        let username = window.localStorage.getItem('heartwire.username');\n        let password = window.localStorage.getItem('heartwire.password');\n\n        return [username, password];\n    },\n\n    setSyncChallenge: function(value) {\n        return this._socket.sendMessage('account.syncChallenge', {\n            syncChallenge: value,\n        }).then(({ data: user }) => {\n            this._userData = user;\n        }).catch(e => console.log(`${e.data.error}:`, e.data.reason));\n    },\n\n    checkSyncChanllenge: function() {\n        return this._userData.syncChallenge;\n    },\n\n    getPartner() {\n        return this._partnerData;\n    }\n\n}, EventTarget).get();\n\nexport default Account;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/Account.js\n **/","/** @lends EventTarget# */\nlet EventTarget = {\n\n    /** @type {Object} */\n    _listeners : null,\n\n    /**\n     * @constructs\n     *\n     * @return {void}\n     */\n    _make : function(){\n        this._listeners = {};\n    },\n\n    /**\n     * registers a new listener for the given event.\n     *\n     * @param {string} type the type of event\n     * @param {function} listener callback to execute when the event fires\n     *\n     * @return {void}\n     */\n    on : function(type, listener){\n        if (!this._listeners[type]) {\n            this._listeners[type] = [];\n        }\n\n        this._listeners[type].push(listener);\n    },\n\n    /**\n     * emmits a new event on this object\n     *\n     * @param {string} type the type of event\n     * @param {*} data data to send to the callbacks\n     *\n     * @return {void}\n     */\n    emit : function(type, data){\n        if (this._listeners[type]) {\n            setTimeout(() =>\n                this._listeners[type].forEach(listener =>\n                    listener.apply(this, [data])\n            ), 0);\n        }\n    }\n};\n\nexport default EventTarget;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/core/prototypes/EventTarget.js\n **/","import { Make } from '../af/util/make.js';\nimport EventTarget from '../af/core/prototypes/EventTarget';\n\nlet ScreenManager = Make(/** @lends ScreenManager */{\n\n    applicationIsActive: false,\n\n    _make: function() {\n        EventTarget._make.apply(this);\n\n        this.applicationIsActive = !document.hidden;\n\n        document.addEventListener('visibilitychange', () => {\n            this.applicationIsActive = !document.hidden;\n\n            this.applicationIsActive ? this.emit('active') : this.emit('inactive');\n\n            console.log('application is', this.applicationIsActive ? 'active' : 'inactive', 'now');\n        });\n\n        document.addEventListener('resume', (e) => {\n            console.log('application has resumed', e);\n        });\n    }\n}, EventTarget)();\n\nexport default ScreenManager;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/ScreenManager.js\n **/","import { Make } from '../af/util/make.js';\nimport IndexedDB from '../af/modules/IndexedDB.js';\n\n\nconst db = Make(IndexedDB)('HeartWireStorage');\nconst MAGIC_CHUNK_SIZE = 20;\n\ndb.define(1)\n    .store({\n        name: 'messages',\n        keyPath: '_id',\n        unique: true,\n    })\n        .index('userMessagesOut', ['date', 'to', '_id'])\n        .index('userMessagesIn', ['date', 'from', '_id'])\n\n    .store({\n        name: 'users',\n        keyPath: '_id',\n        unique: true,\n    })\n        .index('userName', 'userName')\n        .index('userId', '_id');\n\nwindow.db = db;\n\nconst Storage = {\n    getMessages(userId, afterMessageId) {\n        if (!afterMessageId) {\n            return db.read('messages')\n                .where('userMessagesIn')\n                    .equals([null, userId, null])\n                .or('userMessagesOut')\n                    .to([null, userId, null])\n                .sort('DESC')\n                .get(MAGIC_CHUNK_SIZE).catch(e => console.error(e));\n        } else {\n            return db.read('messages')\n                .where('userMessagesIn')\n                    .equals([null, userId, null])\n                    .lowerThan([null, null, afterMessageId])\n                .or('userMessagesOut')\n                    .equals([null, userId, null])\n                    .lowerThan([null, null, afterMessageId])\n                    .sort('DESC')\n                    .get(MAGIC_CHUNK_SIZE).catch(e => console.log(e));\n        }\n    },\n\n    getUserDataById(userId) {\n        return db.read('users')\n            .where('userId')\n            .equals(userId)\n            .get().then(([user]) => user);\n    },\n\n    getUserDataByUserName(userName) {\n        return db.read('users')\n            .where('userName')\n            .equals(userName)\n            .get().then(([user]) => user).catch(e => console.error(e));\n    },\n\n    setUserData(data) {\n        return db.write('users', data).catch(e => console.error(e))\n    },\n\n    /**\n     * @param {Message} message []\n     *\n     * @returns {Promise<*>} []\n     */\n    storeMessage(message) {\n        return db.write('messages', message).catch(e => console.error(e));\n    }\n};\n\nexport default Storage;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/Storage.js\n **/","/**\n * @module IndexedDB\n */\n\nimport { Make } from '../util/make.js';\nimport IndexedQueryCompiler from './IndexedDB/IndexedQueryCompiler.js';\n\nconst IndexedStoreDefinition = {\n    name: '',\n    indexes: null,\n\n    _make: function(info) {\n        this.description = info;\n        this.indexes = [];\n    }\n}\n\nconst IndexedDefinition = {\n    _version: 0,\n\n    /** @type {IndexedStoreDefinition} */\n    _currentStore: null,\n\n    /** @type {IndexedStoreDefinition[]} */\n    _allStores: null,\n\n    _make: function(version) {\n        this._version = version;\n        this._allStores = [];\n    },\n\n    store: function(info) {\n        if (this._currentStore) {\n            this._allStores.push(this._currentStore);\n        }\n\n        if (typeof info === 'string') {\n            info = { name: info };\n        }\n\n        this._currentStore = Make(IndexedStoreDefinition)(info);\n\n        return this;\n    },\n\n    index: function(name, members, options) {\n        this._currentStore.indexes.push({\n            name: name,\n            members: members,\n            options: options,\n        });\n\n        return this;\n    },\n\n    _execute: function(db, transaction) {\n        if (this._currentStore) {\n            this._allStores.push(this._currentStore);\n        }\n\n        this._allStores.forEach(storeDefinition => {\n            let store = null;\n\n            try {\n                store = transaction.objectStore(storeDefinition.name);\n            } catch (e) {\n                if (e.name === 'NotFoundError') {\n                    store = db.createObjectStore(storeDefinition.description.name, storeDefinition.description);\n                } else {\n                    console.error(e);\n                }\n            }\n\n            storeDefinition.indexes.forEach(index => {\n                try {\n                    store.createIndex(index.name, index.members, index.options);\n                } catch (e) {\n                    if (e.name === 'ConstraintError') {\n                        store.deleteIndex(index.name);\n                        store.createIndex(index.name, index.members, index.options);\n                    } else {\n                        console.error(e);\n                    }\n                }\n            });\n        });\n    }\n}\n\nconst IndexedDB = {\n    _name: '',\n\n    /**\n     * [_definitions description]\n     *\n     * @type {Function[]}\n     */\n    _definitions: null,\n\n    _setup: function(success, failure) {\n        let request = window.indexedDB.open(this._name, this._definitions.length - 1);\n\n        request.onsuccess = (event) => success(event.target.result);\n        request.onerror = failure;\n        request.onupgradeneeded = ({ oldVersion: lastVersion, target: {result: db, transaction }}) => {\n            for (let i = lastVersion+1; i < this._definitions.length; i++) {\n                let setup = this._definitions[i];\n\n                setup._execute(db, transaction);\n            }\n        };\n    },\n\n    _make: function(name) {\n        this._name = name;\n        this._definitions = [];\n\n        this._promise = new Promise((success, failure) => {\n            setTimeout(this._setup.bind(this, success, failure), 0);\n        });\n    },\n\n    define: function(version) {\n        this._definitions[version] = Make(IndexedDefinition)(version);\n\n        return this._definitions[version];\n    },\n\n    read: function(storeName) {\n        return Make(IndexedQueryCompiler)(storeName, this._promise);\n    },\n\n    write: function(storeName, value) {\n        return this._promise.then(db => {\n            return new Promise((success, failure) => {\n                try {\n                    let request = db.transaction([storeName], 'readwrite')\n                        .objectStore(storeName).put(value);\n\n                        request.onsuccess = event => success(event.target.result);\n                        request.onerror = failure;\n                } catch (e) {\n                    failure(e);\n                }\n            });\n        });\n    }\n};\n\nexport default IndexedDB;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/IndexedDB.js\n **/","import { Make } from '../../util/make.js';\nimport ArrayUtil from '../../core/objects/ArrayUtil.js';\n\n/**\n * A query object for an indexedDB request.\n *\n * @lends module:IndexedDB.IndexedQuery#\n */\nconst IndexedQuery = {\n    /** @type {string} */\n    name: '',\n\n    /** @type {*} */\n    rangeStart: null,\n\n    /** @type {*} */\n    rangeEnd: null,\n}\n\n/**\n * the query compiler for indexedDB requests.\n *\n * @lends module:IndexedDB.IndexedQueryCompiler#\n */\nconst IndexedQueryCompiler = {\n    /** @type {IndexedQuery} */\n    _currentQuery: null,\n\n    /** @type {IndexedQuery[]} */\n    _allQueries: null,\n    _store: '',\n    _db: null,\n    sortOrder: 'next',\n\n    _make: function(storeName, db) {\n        this._allQueries = [];\n        this._store = storeName;\n        this._db = db;\n    },\n\n    _transformExclude: function(value, exclude) {\n        if (Array.isArray(value)) {\n            value = value.map(item => {\n                return { value: item, exclude: exclude };\n            });\n        } else {\n            value = { value: value, exclude: exclude };\n        }\n\n        return value;\n    },\n\n    where: function(indexName) {\n        this._currentQuery = Make(IndexedQuery)();\n        this._currentQuery.name = indexName;\n\n        return this;\n    },\n\n    equals: function(value) {\n        this.from(value).to(value);\n\n        return this;\n    },\n\n    from: function(value, exclude=false) {\n        value = this._transformExclude(value, exclude);\n\n        if (Array.isArray(this._currentQuery.rangeStart)) {\n            this._currentQuery.rangeStart = ArrayUtil.assignEmpty(this._currentQuery.rangeStart, value);\n        } else {\n            this._currentQuery.rangeStart = value;\n        }\n\n        return this;\n    },\n\n    to: function(value, exclude=false) {\n        value = this._transformExclude(value, exclude);\n\n        if (Array.isArray(this._currentQuery.rangeEnd)) {\n            this._currentQuery.rangeEnd = ArrayUtil.assignEmpty(this._currentQuery.rangeEnd, value);\n        } else {\n            this._currentQuery.rangeEnd = value;\n        }\n\n        return this;\n    },\n\n    lowerThan: function(value) {\n        this.to(value, true);\n\n        return this;\n    },\n\n    higherThan: function(value) {\n        this.from(value, true);\n\n        return this;\n    },\n\n    or: function(indexName) {\n        this._allQueries.push(this._currentQuery);\n        this.where(indexName);\n\n        return this;\n    },\n\n    sort: function(direction) {\n        if (direction === 'ASC') {\n            this.sortOrder = 'next';\n        } else if (direction === 'DESC') {\n            this.sortOrder = 'prev';\n        }\n\n        return this;\n    },\n\n    get: function(...limit) {\n        if (limit.length === 1) {\n            limit.unshift(0);\n        }\n\n        this._allQueries.push(this._currentQuery);\n        this._currentQuery = null;\n\n        return this._execute(limit);\n    },\n\n    _execute: function(start, end) {\n        return this._db.then(db => {\n            let matches = [];\n            let results = [];\n\n            return Promise.all(this._allQueries.map(query => {\n                return new Promise((done, error) => {\n                    let store = db.transaction([this._store], 'readonly').objectStore(this._store);\n                    let range = null;\n                    let rangeArray = Array.isArray(query.rangeStart) || Array.isArray(query.rangeEnd);\n\n                    if (!rangeArray) {\n                        if (query.rangeStart && query.rangeEnd) {\n                            range = IDBKeyRange.bound(query.rangeStart.value, query.rangeEnd.value,\n                                query.rangeStart.exclude, query.rangeEnd.exclude);\n                        } else if (query.rangeStart) {\n                            range = IDBKeyRange.lowerBound(query.rangeStart.value, query.rangeStart.exclude);\n                        } else {\n                            range = IDBKeyRange.upperBound(query.rangeEnd.value, query.rangeEnd.exclude);\n                        }\n                    }\n\n                    let request = store.index(query.name).openCursor(range, this.sortOrder);\n\n                    request.onsuccess = ({ target: { result: cursor } }) => {\n                        if (!cursor) {\n                            return done();\n                        }\n\n                        if (matches.indexOf(JSON.stringify(cursor.primaryKey)) < 0) {\n                            let doesMatch = true;\n                            let keyCount = query.rangeStart && query.rangeStart.length ||\n                                           query.rangeEnd && query.rangeEnd.length;\n\n                            if (start > 0) {\n                                start -= 1;\n                                end -= 1;\n                                return cursor.continue();\n                            } else if (start === 0 && end > 0) {\n                                end -= 1;\n                            } else if (start === 0 && end === 0) {\n                                return done();\n                            }\n\n                            if (rangeArray) {\n                                for (let i = 0; i < keyCount; i++) {\n                                    if (query.rangeStart && query.rangeStart[i].value !== null) {\n                                        if (query.rangeStart[i].exclude) {\n                                            doesMatch = doesMatch && cursor.key[i] > query.rangeStart[i].value;\n                                        } else {\n                                            doesMatch = doesMatch && cursor.key[i] >= query.rangeStart[i].value;\n                                        }\n                                    }\n\n                                    if (query.rangeEnd && query.rangeEnd[i].value !== null) {\n                                        if (query.rangeEnd.exclude) {\n                                            doesMatch = doesMatch && cursor.key[i] < query.rangeEnd[i].value;\n                                        } else {\n                                            doesMatch = doesMatch && cursor.key[i] <= query.rangeEnd[i].value;\n                                        }\n                                    }\n                                }\n                            }\n\n                            if (doesMatch) {\n                                results.push(cursor.value);\n                                matches.push(cursor.primaryKey);\n                            }\n\n                            return cursor.continue();\n                        }\n                    };\n\n                    request.onerror = error;\n                });\n            })).then(() => results);\n        });\n    }\n};\n\nexport default IndexedQueryCompiler;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/IndexedDB/IndexedQueryCompiler.js\n **/","\nconst ArrayUtil = {\n    assignEmpty(target, ...sources) {\n        sources.forEach(source => {\n            Array.prototype.forEach.apply(source, (item, index) => {\n                if (target[index] === null || target[index] === undefined) {\n                    target[index] = item;\n                }\n            });\n        });\n\n        return target;\n    }\n}\n\nexport default ArrayUtil;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/core/objects/ArrayUtil.js\n **/","import { Make } from '../../util/make.js';\nimport Thread from './Thread.js';\nimport ApplicationInternal from './ApplicationInternal.js';\n\nlet Internal = new WeakMap();\n\n/** @lends Application.prototype */\nlet Application = {\n\n    /**\n    * Name of this application so other components can identify the application.\n    *\n    * @type {string}\n    */\n    name : '',\n\n    /**\n    * Some components may need to know the version of this applicaion.\n    *\n    * @type {string}\n    */\n    version : '0.0.0',\n\n    /**\n    * @type {string}\n    */\n    author : '',\n\n    /**\n    * @constructs\n    *\n    * @return {void}\n    */\n    _make : function(){\n        Internal.set(this, Make(ApplicationInternal)());\n    },\n\n    /**\n    * Initializes this application, default interface for components and modules.\n    *\n    * @return {void}\n    */\n    init : function(){\n        console.log(`Initialzing Application \"${this.name}\"!`);\n    },\n\n\n    /**\n    * Registers a new event listener for the given event type.\n    *\n    * @param {string} type the event type\n    * @param {function} listener the listener function\n    *\n    * @return {Application} this application\n    */\n    on : function(type, listener){\n        let scope = Internal.get(this);\n\n        if (!scope.listeners[type]) {\n            scope.listeners[type] = [];\n        }\n\n        scope.listeners[type].push(listener);\n\n        return this;\n    },\n\n    /**\n    * removes a previously attached listener function.\n    *\n    * @param  {string} type     the listener type\n    * @param  {Function} listener the listener function to remove\n    *\n    * @return {void}\n    */\n    removeListener: function(type, listener) {\n        let scope = Internal.get(this);\n\n        if (scope.listeners[type]) {\n            let index = scope.listeners[type].indexOf(listener);\n\n            scope.listeners[type].splice(index, 1);\n        }\n    },\n\n    /**\n    * Emmits a new event on this application.\n    *\n    * @param {string} type event type\n    * @param {Object} data event data\n    *\n    * @return {void}\n    */\n    emit : function(type, data){\n        let scope = Internal.get(this);\n        let name = this.name ? `${this.name}:%c ` : '%c%c';\n\n        if (scope.listeners[type]) {\n            console.log(`%c${name}${type} event emitted`,\n                'font-weight: 900; text-decoration: underline;',\n                'font-weight: initial; text-decoration: initial;');\n\n            setTimeout(() => scope.listeners[type].forEach(f => f(data)), 0);\n        }\n    },\n\n    /**\n    * Creates a new thread for this applicaion.\n    *\n    * @param {function} f function to execute in a new thread\n    *\n    * @return {ApplicationScopeInterface} this applicaion scope\n    */\n    thread : function(f){\n        let scope= Internal.get(this);\n\n        scope.workers.push(Make(Thread)(f));\n\n        return this;\n    },\n\n    /**\n    * This function will try to terminate the application by emitting the termination event.\n    *\n    * @param {string} reason - the reason for the termination.\n    *\n    * @return {void}\n    */\n    terminate : function(reason){\n        this.emit('terminate', reason);\n    }\n\n};\n\nexport default Application;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/core/prototypes/Application.js\n **/","/**\n * @file Thread\n * @deprecated Don't use this anymore. It will be removed soon.\n */\n\nimport Shared from '../objects/Shared.js';\n\n/**\n * this prototype defines a new scope worker\n */\nlet Thread = {\n\n    /**\n     * The parent application of this thread.\n     *\n     * @type {Application}\n     */\n    parent : null,\n\n    /**\n     * The Worker Object for this thread.\n     *\n     * @type {Worker}\n     * @private\n     */\n    _thread : null,\n\n    _promise : null,\n\n    then : null,\n\n    catch : null,\n\n    /**\n     * @constructs\n     * @param {function} f\n     * @param {Application} parent\n     */\n    _make : function(f, parent){\n        this.parent= parent;\n        this.thread= new Worker(Shared.threadLoader);\n        this.thread.postMessage({ name : 'init', func : f });\n        this.progressListeners= [];\n\n        this._promise = new Promise((done) => {\n            this._thread.addEventListener('message', function(e){\n                if(e.data.name == 'af-worker-done')\n                    done(e.data.data);\n            }, false);\n        });\n\n        this._thread.addEventListener('message', e => {\n            if(e.data.name == 'af-worker-progress') {\n                this.emit('progress', e.data.data);\n            }\n        }, false);\n\n        this.then = this._promise.then.bind(this._promise);\n        this.catch = this._promise.catch.bind(this._promise);\n    }\n};\n\nexport default Thread;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/core/prototypes/Thread.js\n **/","/**\n * @file Shared\n * @deprecated Don't use this anymore. It will be removed soon.\n */\n\nexport default {};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/core/objects/Shared.js\n **/","\n/** @lends ApplicationInternal# */\nlet ApplicationInternal = {\n    /**\n     * @type {Thread}\n     */\n    thread : null,\n\n    /**\n     * @type {Worker[]}\n     */\n    workers : null,\n\n    /**\n     * @type {Function[]}\n     */\n    listeners : null,\n\n    /**\n     * @type {Catalog}\n     */\n    modules : null,\n\n    /**\n     * this prototype defines a new application scope\n     *\n     * @constructs\n     *\n     * @return {void}\n     */\n    _make : function(){\n        this.workers= [];\n        this.listeners= [];\n\n        this._make = null;\n    }\n};\n\nexport default ApplicationInternal;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/core/prototypes/ApplicationInternal.js\n **/","import { Make } from '../af/util/make.js';\nimport BottomInput from './BottomInput.js';\nimport DataBinding from '../af/modules/DataBinding.js';\nimport Header from './Header.js';\nimport MessageList from './MessageList.js';\nimport ViewController from './ViewController.js';\n\nconst ChatView = {\n\n    /** @type {Application} */\n    _app: null,\n\n    /** @type {Acocunt} */\n    account: null,\n\n    /** @type {Header} */\n    header: null,\n\n    /** @type {MessageList} */\n    messageList: null,\n\n    /** @type {BottomInput} */\n    bottomInput: null,\n\n    get isVisible() {\n        return this.account.isReady;\n    },\n\n    get isNotVisible() {\n        return !this.account.isReady;\n    },\n\n    get partner() {\n        return this.account && this.account.getPartner();\n    },\n\n    _make: function(app, account) {\n        this._app = app;\n        this.account = account;\n        this._scope = DataBinding.makeTemplate('#chat-view', { view: this }).scope;\n\n        this.header = Make(Header)(this._app);\n        this.messageList = Make(MessageList)();\n        this.bottomInput = Make(BottomInput)();\n\n        this.subscribe(this.account);\n    },\n\n    __proto__: ViewController,\n};\n\nexport default ChatView;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/ChatView.js\n **/","import DataBinding from '../af/modules/DataBinding.js';\n\nlet BottomInput = {\n    currentDraft: '',\n\n    get inputValue() {\n        return this.currentDraft.length > 0 ? this.currentDraft : '<br>';\n\n        // return this.inputFocused ||this.currentDraft.length > 0 ?\n        //    this.currentDraft : (this.inputElement && this.inputElement.getAttribute('placeholder'));\n    },\n\n    set inputValue(value) {\n        this.currentDraft = value.replace(/(^<br>|<br>)$/g, '');\n    },\n\n    inputFocused: false,\n\n    get usePlaceholderClass() {\n        return (!this.inputFocused && this.currentDraft.length === 0) ? 'placeholder': '';\n    },\n\n    /** @type HTMLDivElement */\n    inputElement: null,\n\n    inputFocusChange: function(event) {\n        event.cancleRecycle();\n        this.view.inputFocused = event.type === 'focus';\n        this.__apply__(null, true);\n    },\n\n    scope: null,\n\n    _make: function() {\n        this.scope = DataBinding.makeTemplate('#bottom-input', { view: this });\n    }\n}\n\nexport default BottomInput;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/BottomInput.js\n **/","/**\n * DataBinding Module\n *\n * @module DataBinding\n * @default module:DataBinding.DataBinding\n */\n\nimport { makeTemplate } from './DataBinding/Template.js';\nimport { polyInvoke } from './DataBinding/Util.js';\nimport { bindNode } from './DataBinding/Bind.js';\nimport ViewPort from './DataBinding/ViewPort.js';\nimport './DataBinding/IfBinding.js';\nimport './DataBinding/ElementToScopeBinding.js';\nimport './DataBinding/AttributeBinding.js';\n\nNodeList.prototype.forEach = NamedNodeMap.prototype.forEach = Array.prototype.forEach;\n\nlet style = document.createElement('style');\n\nstyle.innerHTML = `\n    [bind-display=\"false\"] {\n        display: none !important;\n    }\n\n    [bind-visible=\"false\"] {\n        visibility: hidden;\n    }\n`;\n\npolyInvoke(document.head).appendChild(style);\n\n/**\n * [DataBinding description]\n *\n * @type {module:DataBinding.ModuleInterface}\n */\nexport let DataBinding = {\n    makeTemplate : makeTemplate,\n    bindNode : bindNode,\n    ViewPort : ViewPort,\n};\n\nexport default DataBinding;\n\n/**\n * @interface ModuleInterface\n * @borrows module:DataBinding/Bind.bindNode as bindNode\n * @borrows module:DataBinding/Template.makeTemplate as makeTemplate\n * @borrows module:DataBinding/ViewPort.ViewPort\n * @static\n *\n */\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding.js\n **/","/**\n * @module DataBinding/Template\n */\n\nimport { Make } from '../../util/make.js';\nimport { bindNode } from './Bind.js';\nimport { getPolyParent, polyInvoke } from './Util.js';\nimport { importTemplate } from './TemplateLoader.js';\nimport { parseExpression } from './Parser';\nimport RenderEngine from './RenderEngine';\nimport ScopePrototype from './ScopePrototype.js';\n\n/**\n * Instanciates a template based on a specified element.\n *\n * @param  {HTMLTemplateElement}               template    the template to instanciate\n * @param  {module:DataBinding.ScopePrototype} scope       the scope to operate on\n * @param  {Application}                       application the application this binding belongs to\n * @param  {Node}                              item        the original node\n *\n * @return {void}\n */\nlet makeElementFromTemplate = function(template, scope, application, item) {\n    RenderEngine.schedulePostRenderTask(() => {\n    let node = document.importNode(template.content, true);\n    let placeholder = node.querySelector('bind-placeholder');\n\n    item.attributes.forEach(attr => {\n        polyInvoke(node.firstElementChild).setAttribute(attr.name, attr.value);\n    });\n\n    if (placeholder) {\n        let node = item.firstElementChild;\n        polyInvoke(placeholder.parentNode).replaceChild(item.firstElementChild, placeholder);\n\n        [].forEach.apply(item.children, [item => {\n            polyInvoke(node.parentNode).appendChild(item);\n        }]);\n    }\n\n    node.firstElementChild.className = template.id + ' ' + node.firstElementChild.className;\n\n    scope = scope();\n\n    [].map.apply(node.firstElementChild.attributes, [item => {\n        if (item.name.search(/^scope\\-/) > -1 ) {\n            scope[item.name.replace(/^scope\\-/, '')] = item.value;\n        }\n    }]);\n\n    if (template.hasAttribute('component')) {\n        scope.element = node.firstElementChild;\n    }\n\n    scope = bindNode(node, scope);\n\n    polyInvoke(item.parentNode).replaceChild(node, item);\n\n    if (application) {\n        application.emit(`newElement:${template.id}`, scope);\n    }\n    });\n};\n\n/**\n * creates a new instance of an HTML template and applies the binding with\n * the given scope.\n *\n * @function\n *\n * @param {Node|string} template - the template to render\n * @param {ScopePrototype} scope - the scope for this template to bind to\n * @param {Application} [application] - the application this template belongs to\n * @param {ScopePrototype} [parentScope] - the surounding scope of this template node\n *\n * @return {Object} - collection of scope and rendered element\n */\nexport let makeTemplate = function (template, scope, application, parentScope) {\n    template = (typeof template === 'string') ? document.querySelector(template) : template;\n\n    if (template.hasAttribute('src') && !template.processed) {\n        let source = template.getAttribute('src');\n\n        if (parentScope) {\n            let value = parseExpression(source, parentScope);\n\n            source = (value && value != '') ? value : source;\n        }\n\n        scope = Make(scope, ScopePrototype)();\n\n        importTemplate(source, template)\n            .then(template => {\n                template.processed = true;\n                makeTemplate(template, scope, application, parentScope)\n            });\n\n        return scope;\n\n    }else if (template.hasAttribute('bind-element')) {\n        let makeElement = makeElementFromTemplate.bind(this, template, scope, application);\n        let list = document.querySelectorAll(template.id);\n\n        [].forEach.apply(list, [makeElement]);\n\n        (new MutationObserver(mutations => {\n            mutations.forEach(item => {\n                if (item.addedNodes.length > 0) {\n                    let list = [].map.apply(item.addedNodes, [node => {\n                        return node.querySelectorAll ? [].slice.apply(node.querySelectorAll(template.id)) : [];\n                    }]).reduce((prev, next) => prev.concat(next), []);\n\n                    list = list.concat([].filter.apply(item.addedNodes, [node => node.localName === template.id]));\n\n                    [].forEach.apply(list, [makeElement]);\n                }\n            });\n        })).observe(document.body, {\n            childList : true,\n            subtree : true\n        });\n\n    } else {\n        let node = document.importNode(template.content, true);\n        let isReplace = template.hasAttribute('replace');\n        let isInsert = template.hasAttribute('insert');\n\n        scope = bindNode(node, scope);\n\n        if (isReplace || isInsert) {\n            let elementList = [].slice.apply(node.childNodes);\n\n            scope.__cleanElements__ = function(){\n                elementList.forEach(node => {\n                    node.parentNode && node.parentNode.removeChild(node);\n                });\n            }\n        }\n\n        let parentNode = template.parentNode;\n\n        if (template.getAttribute('poly-parent')) {\n            let parentName = template.getAttribute('poly-parent');\n\n            parentNode = getPolyParent(template, parentName);\n        }\n\n        if (isReplace) {\n            console.log('replace template');\n\n            polyInvoke(parentNode).replaceChild(node, template);\n        } else if (isInsert) {\n            polyInvoke(parentNode).insertBefore(node, template);\n        }\n\n        return {node : node, scope : scope };\n    }\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/Template.js\n **/","/**\n * @module DataBinding/Bind\n */\n\nimport { Make, hasPrototype } from '../../util/make.js';\nimport { ObjectParser, parseExpression, assignExpression } from './Parser.js';\nimport { attributeNames } from './Mapping.js';\nimport { polyInvoke } from './Util.js';\nimport AutoBinding from './AutoBinding.js';\nimport Binding from './Binding.js';\nimport BindingRegistry from './BindingRegistry.js';\nimport ClassBinding from './ClassBinding.js';\nimport EnabledBinding from './EnabledBinding.js';\nimport RenderEngine from './RenderEngine';\nimport ScopePrototype from './ScopePrototype.js';\nimport StyleBinding from './StyleBinding';\nimport TemplateRepeatBinding from './TemplateRepeatBinding.js';\nimport TwoWayBinding from './TwoWayBinding.js';\n\n/**\n * Contains all scope, scopeInfo pairs.\n *\n * @type {WeakMap}\n */\nlet scopeList = new Map();\n\n/**\n * @type {ScopePrototype[]}\n */\nlet scopeIndex = [];\n\n/**\n * @type {Array[]}\n */\nexport let watcherList = new Map();\n\n/**\n * @type {Object}\n */\nlet expressionTracking = {};\n\n/**\n * applies the binding to the node for the given scope.\n *\n * @function\n * @param {Node|string} node - the node which should be bound\n * @param {Object} scope - the scope which should be bound to\n * @param {boolean} isolated - indicates if this scope should be recycled isolated\n * @return {module:DataBinding~ScopePrototype} the scope this node is bound to\n */\nexport let bindNode = function(node, scope, isolated) {\n\tscope = hasPrototype(scope, ScopePrototype) ? scope : Make(scope, ScopePrototype)();\n    node = hasPrototype(node, Node) ? node : document.querySelector(node);\n\n\tscopeList.set(scope, {\n\t\tnode : node,\n\t\tbindings : []\n\t});\n\n    scopeIndex.push(scope);\n\n\tcheckNode(node, scope);\n    recycle(isolated ? scope : false);\n\n\treturn scope;\n};\n\n/**\n * Travels through a node and it's children searching for binding expressions\n *\n * @param {Node} node - the node to check\n * @param {module:DataBinding.ScopePrototype} scope - the scope this node should be bound to\n * @param {Node} parentNode - the parent of the provided node\n * @return {void}\n */\nlet checkNode = function(node, scope, parentNode) {\n    let dataRegex = /{{[^{}]*}}/g;\n    let scopeInfo = scopeList.get(scope);\n\n\tif (node.nodeName == '#text' || node.nodeType === 2) {\n    \tlet text = node.value ||polyInvoke(node).textContent,\n            variables = text.match(dataRegex),\n            visibilityBinding = (node.name === attributeNames.get('visible')),\n            transparencyBinding = (node.name === attributeNames.get('transparent')),\n            enabledAttribute = node.name === attributeNames.get('enabled'),\n            classes = (node.name === attributeNames.get('classes')),\n            modelBinding = node.name === attributeNames.get('model'),\n            autoBinding = node.name === 'bind',\n            twoWay = (node.name === attributeNames.get('value') || modelBinding),\n            styleBinding = (node.name === 'bind-style');\n\n        let singleBinding = visibilityBinding || transparencyBinding;\n\n        if (twoWay) {\n            bindTwoWay(text, scope, scopeInfo, node, parentNode, modelBinding);\n        } else if (classes) {\n            bindClasses(text, node, scopeInfo, parentNode);\n        } else if (enabledAttribute) {\n            bindEnabled(text, scopeInfo, parentNode);\n        } else if (autoBinding) {\n            bindAuto(text, scopeInfo, parentNode);\n        } else if (styleBinding) {\n            bindStyle(text, scopeInfo, scope, parentNode);\n        } else if (BindingRegistry.get(node.name) && BindingRegistry.get(node.name).test()) {\n            Make(BindingRegistry.get(node.name))({\n                text: text,\n                variables: variables,\n                scope: scope,\n                scopeInfo: scopeInfo,\n                node: node,\n                parentNode: parentNode,\n            });\n        } else if (variables || singleBinding) {\n            bindSimple(text, node, variables, scopeInfo, singleBinding, parentNode);\n        }\n\n    } else if(node.localName === 'template'){\n        let repeatedTemplate = (node.hasAttribute('replace') &&\n                                node.hasAttribute('repeat')) ||\n                                node.hasAttribute('bind-repeat');\n\n        node.attributes.forEach(child => checkNode(child, scope, node));\n\n        if (repeatedTemplate) {\n            bindTemplateRepeat(node, scopeInfo);\n        }\n    } else {\n        if (node.attributes) {\n            node.attributes.forEach((child) => checkNode(child, scope, node));\n\n            let events = node.getAttribute(attributeNames.get('events'));\n\n        \tif (events !== null) {\n        \t\tbindEvents(events, node, scope);\n\n\t\t\t\tpolyInvoke(node).removeAttribute(attributeNames.get('events'));\n       \t\t}\n        }\n\n        node.childNodes.forEach((node) => { return checkNode(node, scope); });\n    }\n};\n\n/**\n * creates a two way binding\n *\n * @param {string} text - the attribute text\n * @param {module:DataBinding.ScopePrototype} scope - the scope for this binding\n * @param {Object} scopeInfo - the scopeInfo for this binding\n * @param {Node} node - the attribute node\n * @param {Node} parentNode - the actual node\n * @param {boolean} indirect - indicates if this binding is indirect\n * @return {void}\n */\nlet bindTwoWay = function(text, scope, scopeInfo, node, parentNode, indirect){\n    let property = text.replace(/[{}]/g, '');\n    let value = parseExpression(property, scope);\n    let [event, viewBinding, eventBinding, preventDefault] = (parentNode.getAttribute(attributeNames.get('modelEvent')) ||'').split(':');\n    let debounce = null;\n\n    /** @type {TwoWayBinding} */\n    let binding = Make({\n        properties : [property],\n        originalNodeValue : text,\n        currentValue : value,\n        node : node,\n        parentNode : parentNode,\n        indirect : indirect,\n        viewBinding : viewBinding,\n    }, TwoWayBinding).get();\n\n    scopeInfo.bindings.push(binding);\n\n    if (node.name === attributeNames.get('model')) {\n        parentNode.addEventListener(event, e => {\n            if (preventDefault === 'true') {\n                e.preventDefault();\n            }\n\n            if (debounce) {\n                clearTimeout(debounce);\n            }\n\n            debounce = setTimeout(() =>{\n                let value = parseExpression(eventBinding, e);\n                compareTwoWay(value, scope, binding);\n            }, 500);\n        });\n    } else if(node.name === attributeNames.get('value')) {\n        parentNode.addEventListener('keyup', e => {\n            e.preventDefault();\n\n            if (debounce) {\n                clearTimeout(debounce);\n            }\n\n            debounce = setTimeout(() => {\n                compareTwoWay(getElementValue(e.target), scope, binding);\n            }, 500);\n        });\n    }\n};\n\n/**\n * Compares for changes in the UI in a two way binding\n *\n * @param {string} newValue - the new value to compare\n * @param {module:DataBinding.ScopePrototype} scope - the scope of the comparison\n * @param {TwoWayBinding} binding - the binding to compare\n * @return {void}\n */\nlet compareTwoWay = function(newValue, scope, binding){\n    if (binding.currentValue !== newValue) {\n        assignExpression(binding.properties[0], scope, newValue);\n        binding.currentValue = newValue;\n\n        console.log('update from view:', scope);\n\n        recycle();\n    }\n}\n\n/**\n * creates a simple binding\n *\n * @param {string} text the initial text of the node\n * @param {Node} node the text or attribute node of the binding\n * @param {string[]} variables list of expressions\n * @param {Object} scopeInfo meta data of the current scope\n * @param {boolean} singleExpression - indicates if text contains only one expression\n * @param {Node} parentNode the element that contains the text node or attribute\n *\n * @return {void}\n */\nlet bindSimple = function(text, node, variables, scopeInfo, singleExpression, parentNode){\n    /** @type {Binding} */\n    let binding = Make({\n        originalNodeValue : text,\n        node : node,\n        parentNode : parentNode,\n        singleExpression : singleExpression,\n        properties : variables ? variables.map(item => item.replace(/[{}]/g, '')) : []\n    }, Binding).get();\n\n    scopeInfo.bindings.push(binding);\n}\n\n/**\n * binds an object expression to node.className.\n *\n * @param  {string} text      the initial text value of the binding node\n * @param  {Node}   node        the binding node\n * @param  {Object} scopeInfo the meta data of the current scope\n * @param  {Node}   parentNode  the parent of the binding node\n *\n * @return {void}\n */\nlet bindClasses = function(text, node, scopeInfo, parentNode) {\n    let binding = Make({\n        originalNodeValue : text,\n        node : node,\n        classes : ObjectParser(text),\n        parentNode : parentNode\n    }, ClassBinding).get();\n\n    scopeInfo.bindings.push(binding);\n};\n\n/**\n * binds an expression to the disabled attribute.\n *\n * @param  {string} text       the initial value of the binding node\n * @param  {Object} scopeInfo  the meta data of the current scope\n * @param  {Node}   parentNode the parent of the binding node\n *\n * @return {void}\n */\nlet bindEnabled = function(text, scopeInfo, parentNode) {\n    let binding = Make({\n        originalNodeValue : text,\n        parentNode : parentNode\n    }, EnabledBinding)();\n\n    scopeInfo.bindings.push(binding);\n};\n\n/**\n * binds a template to an array or list. The template is repeated for each list item.\n *\n * @param  {Node}   template  the template node\n * @param  {Object} scopeInfo the meta data of the current scope\n *\n * @return {void}\n */\nlet bindTemplateRepeat = function(template, scopeInfo) {\n    let text = template.hasAttribute('bind-repeat') ?\n                            template.getAttribute('bind-repeat') :\n                            template.getAttribute('repeat');\n\n    let marker = document.createComment(`repeat ${template.id} with ${text}`);\n    let binding = Make({\n        originalNodeValue : text,\n        template : template,\n        marker : marker,\n    }, TemplateRepeatBinding)();\n\n    console.log('replace template with marker');\n    polyInvoke(template.parentNode).replaceChild(marker, template);\n    scopeInfo.bindings.push(binding);\n};\n\n/**\n * Binds the events specified for a Node\n *\n * @param {string[]}                          events a string representation of the object with all the event / expression pairs.\n * @param {Node}                              node   the node on which the event listeners should be registered.\n * @param {module:DataBinding~ScopePrototype} scope  the data scope on which the binding happens.\n * @return {void}\n */\nlet bindEvents = function(events, node, scope){\n\tevents = ObjectParser(events);\n\n\tObject.keys(events).forEach(name => {\n\t\tlet [method, modifier] = events[name].split('|');\n\n        if (scope.$methods && scope.$methods[method.trim()]) {\n            node.addEventListener(name.trim(), e => {\n                scope.$methods[method.trim()].apply(scope, [e]);\n\n                scope.__apply__();\n            });\n        } else {\n            method = parseExpression(method.trim(), scope);\n\n            node.addEventListener(name.trim(), e => {\n                let canceled = false;\n\n                e.cancleRecycle = function(){\n                    canceled = true;\n                }\n\n                method.apply(scope, [e]);\n\n                if (!canceled)\n                    scope.__apply__();\n            }, modifier === 'capture');\n        }\n\t});\n};\n\n/**\n * automatically binds a template to a property of the current scope\n *\n * @param  {string} text      the binding text\n * @param  {Object} scopeInfo the meta data of the current scope\n * @param  {Node}   template  the template node\n *\n * @return {void}\n */\nlet bindAuto = function(text, scopeInfo, template) {\n    let binding = Make({\n        scopeName : text,\n        template : template\n    }, AutoBinding)();\n\n    scopeInfo.bindings.push(binding);\n}\n\n/**\n * binds visual properties to the scope\n *\n * @param  {string}                            text       the binding text\n * @param  {Object}                            scopeInfo  the meta data of the scope\n * @param  {module:DataBinding~ScopePrototype} scope      the current scope\n * @param  {Node}                              parentNode the parent of the binding node\n *\n * @return {void}\n */\nlet bindStyle = function(text, scopeInfo, scope, parentNode) {\n    let binding = Make({\n        bindings: text,\n        parentNode: parentNode,\n    }, StyleBinding)(scope);\n\n    scopeInfo.bindings.push(binding);\n}\n\n/**\n * executes every watcher for the given scope.\n *\n * @param  {module:DataBinding~ScopePrototype} scope the current scope\n *\n * @return {void}\n */\nlet executeWatchers = function(scope) {\n    watcherList.get(scope) && watcherList.get(scope).forEach(watcher => {\n        let value = parseExpression(watcher.expression, scope);\n\n        expressionTracking[watcher.expression] = expressionTracking[watcher.expression] ||{ value : '', newValue : '' };\n\n        if (expressionTracking[watcher.expression].value !== value) {\n            watcher.cb.apply(scope, [value]);\n\n            expressionTracking[watcher.expression].newValue = value;\n        }\n    });\n}\n\n/**\n * Checks every binding for the given scope and updates every value.\n *\n * @function\n * @param {module:DataBinding~ScopePrototype} [scope] the scope to recycle\n *\n * @return {void}\n */\nexport let recycle = function (scope) {\n    RenderEngine.scheduleRenderTask(() => {\n        let t0 = window.performance.now();\n\n        if (scope) {\n            executeWatchers(scope);\n            scopeList.get(scope).bindings.forEach(binding => binding.update(scope));\n\n        } else {\n            scopeIndex.forEach(scope => {\n                executeWatchers(scope);\n    \t        scopeList.get(scope).bindings.forEach(binding => binding.update(scope));\n            });\n        }\n\n        Object.keys(expressionTracking).forEach(expr => {\n            expr = expressionTracking[expr];\n\n            expr.value = expr.newValue;\n        });\n\n        let t1 = window.performance.now();\n        let duration = ((t1 - t0) / 1000);\n        let color = null;\n\n        if (duration >= 0.033) {\n            color = 'red';\n        } else if (duration >= 0.016) {\n            color = 'yellow';\n        } else {\n            color = 'green';\n        }\n\n        color = `color: ${color};`;\n        duration = duration.toFixed(2);\n\n        if (scope) {\n            console.log(`scope recycled in %c${duration}s`, color);\n        } else {\n            console.log(`full recycle in %c${duration}s`, color);\n        }\n    }, scope || 'DataBindingRecycle');\n};\n\n/**\n * destories a scope.\n *\n * @function\n * @param {module:DataBinding~ScopePrototype} scope the scope to destory\n * @param {boolean} inProgress                indicates if this is an initial call or not.\n *\n * @return {void}\n */\nexport let destoryScope = function(scope, inProgress) {\n    console.log(scopeList);\n    let scopeInfo = scopeList.get(scope);\n\n    let [scopes, bindings] = scopeInfo.bindings.reduce((prev, binding) => {\n        let [scopes, bindings] = prev;\n\n        if (binding.destory) {\n            let [scopes_add, bindings_add] = binding.destory();\n\n            scopes += scopes_add;\n            bindings += bindings_add;\n        }\n\n        return [scopes, bindings];\n    }, [0, 0]);\n\n    bindings += scopeInfo.bindings.length;\n    scopes += 1;\n\n    scopeList.delete(scope);\n    scopeIndex.splice(scopeIndex.indexOf(scope), 1);\n    watcherList.delete(scope);\n\n    if (inProgress) {\n        return [scopes, bindings];\n    } else {\n        console.log(`${scopes} scopes and ${bindings} bindings cleaned!`);\n    }\n};\n\n/**\n * Returns the value of an DOM Node\n *\n * @param {Node} node the node to fetch the value from\n *\n * @return {string} value of this node\n */\nlet getElementValue = function(node){\n    if (node.localName === 'input') {\n        return node.value;\n    } else {\n        return 'UNKNOWN NODE!';\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/Bind.js\n **/","/**\n * @module DataBinding/Parser\n */\n\n/**\n * Parses an object expression\n *\n * @param {string} source - the string to parse.\n * @return {Object} the parsed result.\n */\nexport let ObjectParser = function(source){\n    let target = null;\n    let key = false;\n    let keyBuffer = '';\n    let valueBuffer = '';\n    let run = true;\n\n    source.split('').forEach((char) => {\n        if (run) {\n            if (char === '{') {\n                target = {};\n                key = true;\n            } else if(char === ':') {\n                key = false;\n            } else if(char === ',') {\n                target[keyBuffer.trim()] = valueBuffer.trim();\n                keyBuffer = valueBuffer = '';\n                key = true;\n            } else if(char === '}') {\n                target[keyBuffer.trim()] = valueBuffer.trim();\n                run = false;\n            } else if(key) {\n                keyBuffer += char;\n            } else if(!key) {\n                valueBuffer += char;\n            }\n        }\n    });\n\n    return target;\n};\n\n/**\n * Parses a given expression in the context of the given scope.\n *\n * @param {string} expression - the expression to parse.\n * @param {ScopePrototype} scope - the scope on which the expression should be parsed.\n * @return {*} the result value.\n */\nexport let parseExpression = function(expression, ...contexts){\n\tlet chain = expression.match(/\\w+(?:\\([^\\(\\)]*\\))*/g);\n    let scope = null;\n    let functionTest = /\\(((([\\w\\.]+)(, |,|))+)\\)/;\n\n    for (let i = 0; i < contexts.length; i++) {\n        scope = contexts[i];\n\n        chain.forEach((item) => {\n            let pos = item.search(functionTest);\n\n            if (scope) {\n                if (pos > 0) {\n                    let args = item.match(functionTest)[1].split(',').map(item => item.trim());\n                    let scopeChild = scope[item.substring(0, pos)];\n\n                    if (scopeChild) {\n                        args = args.map(arg => parseExpression(arg, ...contexts));\n                        scope = scopeChild.apply(scope, args);\n                    } else {\n                        return null;\n                    }\n                } else {\n                    scope = scope[item];\n                }\n            }\n        });\n\n        if (scope !== null && scope !== undefined) {\n            break;\n        }\n    }\n\n    return (scope !== null &&typeof scope !== \"undefined\") ? scope : '';\n};\n\n/**\n * Assings an value to an expression in an given scope\n *\n * @param {string} expression the expression on whith the value should be assigned\n * @param {ScopePrototype} scope the scope to operate on\n * @param {string} value the value to assign\n *\n * @return {void}\n */\nexport let assignExpression = function(expression, scope, value){\n    let chain = expression.split('.');\n\n    chain.forEach((property, index) => {\n        if (chain.length -1 !== index) {\n            scope = scope[property];\n        } else {\n            scope[property] = value;\n        }\n    });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/Parser.js\n **/","/**\n * @module DataBinding/Mapping\n */\n\n/**\n * Contains all the attribute names\n *\n * @namespace\n */\nexport let attributeNames = {\n    events : 'events',\n    visible : 'display',\n    transparent : 'visible',\n    classes : 'class',\n    value : 'value',\n    prefix : 'bind',\n    enabled : 'enabled',\n    model : 'model',\n    modelEvent : 'model-event',\n\n    /**\n     * returns the value for a key\n     *\n     * @param  {string} key the key to lookup\n     *\n     * @return {string}     the coresponding value\n     */\n    get : function(key){\n        return `${this.prefix}-${this[key]}`;\n    },\n\n    /**\n     * cuts off the prefix of the name\n     *\n     * @param  {string} name initial value\n     *\n     * @return {string}      the clean value\n     */\n    rename : function(name){\n        return name.replace(`${this.prefix}\\-`, '');\n    }\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/Mapping.js\n **/","import { Mixin, hasPrototype } from '../../util/make.js';\n\n/**\n * selects a dom node by the given query.\n *\n * @function\n * @deprecated don't use this anymore, polyMask is deprecated.\n *\n * @param {string} query the query selector to search for on the DOM\n * @param {Node} [context] the node to start the searching on\n *\n * @return {Node} the first node that matches the selector\n */\nexport let selectElement = function(query, context){\n    let node = null;\n\n    if (context) {\n        node = context.querySelector(query);\n    } else {\n        node = document.querySelector(query);\n    }\n\n    node = polyMask(node);\n\n    return node;\n};\n\n/**\n * @function\n * @deprecated don't use anymore. Use {@link document.querySelectorAll}\n *\n * @param {string} query the query to look for\n * @param {Node} context the node to start the searching on\n *\n * @return {NodeList} the node list with all matching nodes\n */\nexport let selectAllElements = function(query, context) {\n    let nodeList = null;\n\n    if (context) {\n        nodeList = context.querySelectorAll(query);\n    } else {\n        nodeList = document.querySelectorAll(query);\n    }\n\n    if (window.Polymer) {\n        nodeList = [].map.apply(nodeList, [polyMask]);\n    }\n\n    return nodeList;\n}\n\n/**\n * attempts to extract the original node from an polymer node\n *\n * @function\n * @deprecated there is no need to use this function anymore\n *\n * @param {Node} node the node to unwrap\n *\n * @return {Node} a mixin exposing the original node\n */\nexport let unwrapPolymerNode = function(node) {\n    if (!hasPrototype(node, Node)) {\n        return Mixin(node, node.node);\n    }\n\n    return node;\n}\n\n/**\n * creates a mixin of the node and a wrapped version from Polymer\n *\n * @function\n * @deprecated this method shouldn't be used anymore. Use polyInvoke\n *\n * @param {Node} node the dom node to mask\n *\n * @return {Node} returns the masked node\n */\nexport let polyMask = function(node){\n    let polyNode = {};\n\n    let additions = {\n        get bare (){\n            return node;\n        }\n    };\n\n    if (window.Polymer) {\n        polyNode = window.Polymer.dom(node);\n    }\n\n    return Mixin(polyNode, node, additions);\n};\n\n/**\n * Tries to call Polymers dom() function if available, to keep them in the loop.\n *\n * @param {Node} node the node we want to take care of.\n * @return {Node} the dom node, maybe wrapped.\n */\nexport let polyInvoke = function(node) {\n\n    if (window.Polymer) {\n        node = window.Polymer.dom(node);\n    }\n\n    return node;\n}\n\n/**\n * attempts to find a parent node with a particular node name\n *\n * @function\n *\n * @param {Node} node the base node\n * @param {string} parentName the node name to search for\n *\n * @return {Node} the node we where searching for \n */\nexport let getPolyParent = function(node, parentName){\n    while (node && node.localName !== parentName) {\n        node = node.parentNode;\n    }\n\n    return node;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/Util.js\n **/","import { Make } from '../../util/make.js';\nimport Binding from './Binding.js';\nimport { parseExpression } from './Parser.js';\nimport { makeTemplate } from './Template.js';\n\nlet AutoBinding = Make(/** @lends module:DataBinding.AutoBinding.prototype*/{\n\n    scopeName : '',\n\n    /** @type {HTMLTemplateNode} */\n    template : null,\n\n    /** @type {boolean} */\n    _isBound : false,\n\n    /**\n     * An auto binding instanciates a template and binds it\n     * to a property of the current scope.\n     *\n     * @constructs\n     * @extends module:DataBinding.Binding\n     * @return {void}\n     */\n    _make : function(){},\n\n    /** @type module:DataBinding.ScopePrototype */\n    _scope : null,\n\n    update : function(scope) {\n        if (!this._isBound) {\n            let subScope = parseExpression(this.scopeName, scope);\n\n            setTimeout(() => {\n                let scopeHolder = null;\n                let scopeObjName = null;\n\n                if (this.scopeName.lastIndexOf('.') > 0) {\n                    scopeHolder = this.scopeName.split('.');\n                    scopeObjName =  scopeHolder.pop();\n                    scopeHolder = parseExpression(scopeHolder.join('.'), scope);\n\n                    scopeHolder[scopeObjName] = makeTemplate(this.template, subScope, true);\n\n                    this._scope = scopeHolder[scopeObjName];\n                } else {\n                    this._scope = makeTemplate(this.template, subScope, true);\n                }\n            }, 0);\n\n            this._isBound = true;\n        }\n    },\n\n    /**\n     * destroys this binding. This binding needs to be destroied before\n     * it is deleted, since it creates a new scope.\n     *\n     * @return {void}\n     */\n    destory : function(){\n        if (this._scope) {\n            return this._scope.__destroy__(true);\n        } else {\n            return [0, 0];\n        }\n    }\n\n}, Binding).get();\n\nexport default AutoBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/AutoBinding.js\n **/","import { hasPrototype } from '../../util/make';\nimport { parseExpression } from './Parser.js';\nimport { polyInvoke } from './Util.js';\n\n/** @lends module:DataBinding.Binding.prototype */\nlet Binding = {\n\n    /**\n     * @type {string[]}\n     */\n    properties : null,\n\n    /**\n     * @type {string}\n     */\n    originalNodeValue : '',\n\n    /**\n     * @type {Node}\n     */\n    node : null,\n\n    /**\n     * @type {Node}\n     */\n    parentNode : null,\n\n    /**\n     * @type {Boolean}\n     */\n    singleExpression : false,\n\n    /**\n     * The basic prototype for bindings. Any binding should inherit form this prototype.\n     *\n     * @constructs\n     * @return {void}\n     */\n    _make : function() {\n        this.properties = [];\n    },\n\n    /**\n     * updates a binding. The model will be checked for changes\n     * and new data will be applied to the binding target.\n     *\n     * @param  {module:DataBinding.ScopePrototype} scope the scope on which\n     *                                             this binding should operate.\n     *\n     * @return {void}\n     */\n    update : function(scope){\n        let text = this.originalNodeValue;\n        let localNode = {element: this.parentNode };\n        let values = this.properties.map(key => {\n            let item = { name : key, value : parseExpression(key, localNode, scope) };\n\n            return item;\n        });\n\n        if (this.singleExpression) {\n                text = parseExpression(text, localNode, scope);\n        } else {\n            values.forEach(pair => {\n                text = text.replace(`\\{\\{${pair.name}\\}\\}`, pair.value);\n            });\n        }\n\n        text = text.toString().trim().split(/\\s+/).join(' ');\n\n        if (hasPrototype(this.node, window.Attr)) {\n            if (this.parentNode.getAttribute(this.node.name) !== text) {\n                polyInvoke(this.parentNode).setAttribute(this.node.name, text);\n            }\n        } else {\n            text = text.toString().replace(/\\&nbsp\\;/g, '\\u00a0');\n\n            if (this.node.textContent !== text) {\n                this.node.textContent = text;\n            }\n        }\n    },\n\n    test: function() { return true; }\n};\n\nexport default Binding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/Binding.js\n **/","/**\n * @module DataBinding/BindingRegistry\n */\n\n/**\n * Registry of all bindings.\n *\n * @type {Object}\n */\nlet registry = {};\n\n\n/**\n * Public Singleton Interface for the binding registry.\n *\n * @class BindingRegistry\n */\n/** @lends module:DataBinding/BindingRegistry~BindingRegistry.prototype */\nlet BindingRegistry = {\n\n    /**\n     * @param {Binding} binding - new binding type\n     * @return {boolean} - success status\n     */\n    register : function(binding) {\n        if (!registry[binding.name]) {\n            registry[binding.name] = binding;\n            return true;\n\n        } else {\n            console.warn(`Binding type ${binding.name} already exists!`);\n            return false;\n        }\n    },\n\n    /**\n     * @param {string} name - binding name\n     * @return {Binding} - the binding for the given name\n     */\n    get: function(name) {\n        return registry[name];\n    }\n}\n\n/**\n * @member BindingRegistry\n * @static\n * @type module:DataBinding/BindingRegistry~BindingRegistry\n */\nexport default BindingRegistry;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/BindingRegistry.js\n **/","import { Make } from '../../util/make.js';\nimport { parseExpression } from './Parser.js';\nimport Binding from './Binding.js';\nimport RenderEngine from './RenderEngine';\n\nlet ClassBinding = Make(/** @lends module:DataBinding.ClassBinding.prototype */{\n\n    /**\n     * @type {Object}\n     */\n    classes : null,\n\n    /**\n     * @type {Node}\n     */\n    parentNode : null,\n\n    /**\n     * @constructs\n     * @extends {module:DataBinding.Binding}\n     */\n    _make : Binding._make,\n\n    /**\n     * applies a class to the parent node, based on the binding values.\n     *\n     * @param  {module:DataBinding.ScopePrototype} scope the scope to operate on.\n     * @param  {Object} classes class-expression-map\n     * @param  {string} key     the class name to apply\n     *\n     * @return {void}\n     */\n    applyClass : function(scope, classes, key) {\n        let expression = classes[key];\n        let value = parseExpression(expression, scope);\n\n        key = (key[0] === '!') ? key.substr(1) : key;\n\n        if (value) {\n            this.parentNode.classList.add(key);\n        } else {\n            this.parentNode.classList.remove(key);\n        }\n    },\n\n    update : function(scope){\n        let classes = JSON.parse(JSON.stringify(this.classes));\n\n        Object.keys(classes)\n            .filter(key => key.indexOf('!') === 0)\n            .forEach(this.applyClass.bind(this, scope, classes));\n\n        RenderEngine.scheduleRenderTask(() => {\n            Object.keys(classes)\n                .filter(key => key.indexOf('!') !== 0)\n                .forEach(this.applyClass.bind(this, scope, classes));\n        });\n    }\n\n}, Binding).get();\n\nexport default ClassBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/ClassBinding.js\n **/","/**\n * @module RenderEngine\n */\n\nimport { Make } from '../../util/make';\nimport TaskList from './RenderEngine/TaskList';\n\n/** @type {Function[]} */\nlet preRenderHooks = [];\n\n/** @type {Function[]} */\nlet postRenderHooks = [];\n\n/** @type {module:RenderEngine.TaskList} */\nlet preRenderTasks = Make(TaskList)();\n\n/** @type {module:RenderEngine.TaskList} */\nlet renderTasks = Make(TaskList)();\n\n/** @type {Function[]} */\nlet postRenderTasks = [];\n\n/** @type {Function[]} */\nlet nextPostRenderTasks = [];\n\n/** @type {boolean} */\nlet active = false;\n\n/**\n * performs all render tasks from one frame. This is one render cycle.\n *\n * @return {void}\n */\nlet renderCycle = function() {\n    active = false;\n\n    // run all post render hooks after a frame has been painted. So this happens\n    // at the beginning of the next cycle.\n    postRenderHooks.forEach(hook => hook());\n    postRenderTasks.forEach(task => task());\n\n    // init render cycle.\n    // nothing at the moment.\n\n    // run the pre render hooks before we start to do render stuff.\n    preRenderHooks.forEach(hook => hook());\n\n    // run pre render tasks\n    let tasks = preRenderTasks.tasks;\n    preRenderTasks.flush();\n    tasks.forEach(task => task());\n\n    //run all render tasks.\n    tasks = renderTasks.tasks;\n    renderTasks.flush();\n    tasks.forEach(task => task());\n\n    //finish rendering, final steps\n    postRenderTasks = nextPostRenderTasks;\n    nextPostRenderTasks = [];\n\n    // done wait for next frame.\n    scheduleNextFrame();\n};\n\n/**\n * Schedules a new render cycle in the browsers rendeing engine.\n * The cycle is performed as soon as the browser is ready to render a new frame.\n *\n * @return {void}\n */\nlet scheduleNextFrame = function() {\n    if (!active && (postRenderHooks.length > 0 ||preRenderHooks.length > 0 ||\n        renderTasks.length > 0 ||postRenderTasks.length > 0 ||nextPostRenderTasks.length > 0)) {\n            window.requestAnimationFrame(renderCycle);\n\n            active = true;\n    }\n}\n\n\n/**\n * RenderEngine Singleton\n *\n * @namespace\n */\nlet RenderEngine = {\n\n    /**\n     * @param {Function} f a hook function to execute before each render cycle\n     * @return {Function} returns the function which has been passed in\n     */\n    addPreRenderHook: function(f) {\n        preRenderHooks.push(f);\n        scheduleNextFrame();\n\n        return f;\n    },\n\n    /**\n     * @param {Function} f - a hook function to execute after each render cycle\n     * @return {Function} returns the function which has been passed in.\n     */\n    addPostRenderHook: function(f) {\n        postRenderHooks.push(f);\n        scheduleNextFrame();\n\n        return f;\n    },\n\n    /**\n     * Removes a previously added pre render hook\n     *\n     * @param  {Function} f - the function which was previously added\n     * @return {*} - see Array.prototype.splice\n     */\n    removePreRenderHook: function(f) {\n        return preRenderHooks.splice(preRenderHooks.indexOf(f), 1);\n    },\n\n    /**\n     * Removes a previously added post render hook\n     *\n     * @param  {Function} f - the function which was previously added\n     * @return {*} {@link Array.prototype.splice}\n     */\n    removePostRenderHook: function(f) {\n        return postRenderHooks.splice(postRenderHooks.indexOf(f), 1);\n    },\n\n    /**\n     * @param {Function} f - the task to preform in the next render cycle.\n     * @param {string} [id] optional task id\n     * @return {Function} the function which has been passed in.\n     */\n    schedulePreRenderTask: function(f, id) {\n        preRenderTasks.push(f, id);\n        scheduleNextFrame();\n\n        return f;\n    },\n\n    /**\n     * @param {Function} f - the task to preform in the next render cycle.\n     * @param {string} [id] optional task id\n     * @return {Function} the function which has been passed in.\n     */\n    scheduleRenderTask: function(f, id) {\n        renderTasks.push(f, id);\n        scheduleNextFrame();\n\n        return f;\n    },\n\n    /**\n     * @param {Function} f - the task to preform after the next render cycle.\n     * @return {Function} the function which has been passed in.\n     */\n    schedulePostRenderTask: function(f) {\n        nextPostRenderTasks.push(f);\n        scheduleNextFrame();\n\n        return f;\n    },\n\n    /**\n     * Forces the engine to render a new frame even if there are no tasks\n     *\n     * @return {void}\n     */\n    renderFrame: function() {\n        if(!active) {\n            scheduleNextFrame();\n        }\n    }\n};\n\n/**\n * @member {module:RenderEngine~RenderEngine} RenderEngine\n * @static\n */\nexport default RenderEngine;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/RenderEngine.js\n **/","\n/** @lends module:RenderEngine.TaskList.prototype */\nlet TaskList = {\n\n    /** @type Array */\n    tasks: null,\n\n    /** @type Array */\n    registeredIds: null,\n\n    /**\n     * Render TaskList to manage rendertaks and optionally track duplicates by ids.\n     *\n     * @constructs\n     * @return {void}\n     */\n    _make: function() {\n        this.tasks = [];\n        this.registeredIds = [];\n    },\n\n    /**\n     * adds a new item to the task list.\n     *\n     * @param  {Function} task the task to add to the list\n     * @param  {string} [id] the id of this tasks. If provided no task with the same id can be added again.\n     * @return {void}\n     */\n    push: function(task, id) {\n        if (!id || this.registeredIds.indexOf(id) < 0) {\n            this.tasks.push(task);\n\n            if (id) {\n                this.registeredIds.push(id);\n            }\n        }\n    },\n\n    /** @type {number} */\n    get length(){\n        return this.tasks.length;\n    },\n\n    flush: function() {\n        this.tasks = [];\n        this.registeredIds = [];\n    }\n};\n\nexport default TaskList;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/RenderEngine/TaskList.js\n **/","import { Make } from '../../util/make.js';\nimport { parseExpression } from './Parser.js';\nimport { polyInvoke } from './Util.js';\nimport Binding from './Binding.js';\n\nlet EnabledBinding = Make(/** @lends module:DataBinding.EnabledBinding# */{\n    /**\n     * @type {Node}\n     */\n    parentNode : null,\n\n    /**\n     * @constructs\n     * @extends {module:DataBinding.Binding}\n     */\n    _make: Binding._make,\n\n    /**\n     * @param {module:DataBinding.ScopePrototype} scope the scope to work on\n     * @return {void}\n     */\n    update : function(scope){\n        let value = parseExpression(this.originalNodeValue, scope);\n\n        if (!value) {\n            polyInvoke(this.parentNode).setAttribute('disabled', '');\n        } else {\n            polyInvoke(this.parentNode).removeAttribute('disabled');\n        }\n    }\n\n}, Binding).get();\n\nexport default EnabledBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/EnabledBinding.js\n **/","import { parseExpression } from './Parser';\nimport {recycle, watcherList, destoryScope } from './Bind.js';\n\n/**\n * @class ScopePrototype\n * @memberof module:DataBinding\n */\n\n/**\n * @lends module:DataBinding.ScopePrototype.prototype\n */\nlet ScopePrototype = {\n\n    _make: function() {\n        this.__apply__ = this.__apply__.bind(this);\n    },\n\n    /**\n    * will apply the current state of the bound model.\n    *\n    * @param {function} [fn]            function to execute before rendering\n    * @param {boolean} [localRecycle]   only recycle the current scope\n    *\n    * @return {void}\n    */\n    __apply__ : function(fn, localRecycle){\n        if (fn) {\n            fn();\n        }\n\n        return recycle(localRecycle ? this : null);\n    },\n\n    /**\n     * starts to watch the given expression and fires when the value changes.\n     *\n     * @param  {string}   expression the expression to watch\n     * @param  {Function} cb         will be called once the value changes\n     *\n     * @return {void}\n     */\n    __watch__ : function(expression, cb) {\n        if (!watcherList.has(this)) {\n            watcherList.set(this, []);\n        }\n\n        watcherList.get(this).push({\n            expression : expression,\n            cb : cb\n        });\n    },\n\n    /**\n     * destorys a scope\n     *\n     * @param  {boolean} inProgress whenever this is an initial call or not\n     *\n     * @return {boolean} status\n     */\n    __destroy__ : function(inProgress) {\n        return destoryScope(this, inProgress);\n    },\n\n    /**\n    * resolves when the expression returns not undefined or null\n    *\n    * @param  {string|Function}   expression the expression to evaluate\n    *\n    * @return {Promise}                      resolves when stable\n    */\n    require: function(expression) {\n        return new Promise((done) => {\n            let value = null;\n\n            if (typeof expression === 'function') {\n                value = expression();\n            } else {\n                value = parseExpression(expression, this);\n            }\n\n            if (value !== undefined && value !== null) {\n                done(value);\n            }\n        });\n    }\n};\n\nexport default ScopePrototype;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/ScopePrototype.js\n **/","/**\n * @module DataBinding/StyleBinding\n */\n\nimport { Make } from '../../util/make';\nimport { ObjectParser, assignExpression } from './Parser';\n\nimport Binding from './Binding';\nimport RenderEngine from './RenderEngine';\n\n/**\n * @param {StyleBinding} container - binding container\n * @param {ScopePrototype} scope - the scope for this binding\n * @return {void}\n */\nlet readStyleProperties = function(container, scope){\n    Object.keys(container.bindings).forEach(styleKey => {\n        let style = window.getComputedStyle(container.parentNode);\n        let dimensions = container.parentNode.getBoundingClientRect();\n\n        if(styleKey.split('.')[0] === 'dimensions') {\n            let value = dimensions[styleKey.split('.')[1]];\n\n            assignExpression(container.bindings[styleKey], scope, value);\n        } else {\n            assignExpression(container.bindings[styleKey], scope, style[styleKey]);\n        }\n    });\n}\n\nlet StyleBinding = Make(/** @lends module:DataBinding/StyleBinding~StyleBinding# */{\n    bindings: null,\n\n    /**\n     * @constructs\n     * @extends {module:DataBinding.Binding}\n     *\n     * @return {void}\n     */\n    _make: function() {\n        this.bindings = ObjectParser(this.bindings);\n    },\n\n    update: function(scope) {\n        RenderEngine.schedulePostRenderTask(readStyleProperties.bind(null, this, scope));\n    }\n}, Binding).get();\n\n/**\n * @member StyleBinding\n * @type {module:DataBinding/StyleBinding~StyleBinding}\n * @static\n */\nexport default StyleBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/StyleBinding.js\n **/","import { Make } from '../../util/make.js';\nimport Binding from './Binding.js';\nimport { parseExpression } from './Parser.js';\nimport { bindNode } from './Bind.js';\nimport { polyInvoke, getPolyParent } from './Util.js';\n\nlet TemplateRepeatBinding = Make(/** @lends module:DataBinding.TemplateRepeatBinding# */{\n\n    /**\n     * @type {WeakMap}\n     */\n    itemNodeList : null,\n\n    /**\n     * @type {WeakMap}\n     */\n    itemScopeList : null,\n\n    /**\n     * @type {Node}\n     */\n    template : null,\n\n    /**\n     * @type {Node}\n     */\n    marker : null,\n\n    /**\n     * @type {Array}\n     */\n    modelBackup : null,\n\n    /**\n     * @constructs\n     * @extends {Binding}\n     * @return {void}\n     */\n    _make : function(){\n        Binding._make.apply(this);\n\n        this.itemNodeList = new Map();\n        this.itemScopeList = new Map();\n        this.modelBackup = [];\n    },\n\n    /**\n     * renders one model item to the DOM\n     *\n     * @param  {*} model      [description]\n     * @param  {ScopePrototype} scope      [description]\n     * @param  {string} itemName   [description]\n     * @param  {DocumentFragment} fragment   [description]\n     * @param  {Node} polyParent [description]\n     * @param  {Object} item       [description]\n     * @param  {number} index      [description]\n     * @return {void}            [description]\n     */\n    renderItem : function(model, scope, itemName, fragment, polyParent, item, index){\n        let node = null;\n\n        if (this.itemNodeList.has(item)) {\n            node = this.itemNodeList.get(item);\n            let childScope = this.itemScopeList.get(item);\n\n            childScope.$first = index === 0;\n            childScope.$last = model.length -1 === index;\n            childScope.$index = index;\n        } else {\n            let childScope = Make({\n                $first : index === 0,\n                $last : model.length-1 === index,\n                $index : index,\n                __parentScope__ : scope,\n            }, scope).get();\n\n            childScope[itemName] = item;\n\n            node = document.importNode(this.template.content, true).firstElementChild;\n            bindNode(node, childScope, true);\n\n            this.itemNodeList.set(item, node);\n            this.itemScopeList.set(item, childScope);\n        }\n\n        fragment.appendChild(node);\n    },\n\n    update : function(scope){\n        let [itemName, link, expression] = this.originalNodeValue.split(' ');\n        let model = parseExpression(expression, scope);\n        let polyParent = this.template.getAttribute('bind-polymer-parent');\n        let dirty = false;\n\n        if (link !== 'in') {\n            console.console.error('DataBinding: invalide expression', this.originalNodeValue);\n            return;\n        }\n\n        model = model && Array.isArray(model) ? model : [];\n        dirty = this.modelBackup.length !== model.length;\n\n        if (!dirty) {\n            for (let i = 0; i < model.length; i++) {\n                if (model[i] !== this.modelBackup[i]) {\n                    dirty = true;\n                    break;\n                }\n            }\n        }\n\n        if (dirty) {\n            this.modelBackup.forEach(item => {\n                if (model.indexOf(item) < 0) {\n                    if (polyParent) {\n                        polyInvoke(getPolyParent(this.marker, polyParent)).removeChild(this.itemNodeList.get(item));\n                    } else {\n                        polyInvoke(this.marker.parentNode).removeChild(this.itemNodeList.get(item));\n                    }\n\n                    this.itemScopeList.delete(item);\n                    this.itemNodeList.delete(item);\n                }\n            });\n\n            this.modelBackup = model.slice();\n\n            if (window.Polymer) {\n                window.Polymer.dom.flush();\n            }\n\n            /** @type {DocumentFragment} */\n            let fragment = new DocumentFragment();\n\n            model.forEach(this.renderItem.bind(this, model, scope, itemName, fragment, polyParent));\n\n            if (this.marker.nextElementSibling) {\n                if (polyParent) {\n                    polyInvoke(getPolyParent(this.marker, polyParent)).insertBefore(fragment, this.marker.nextElementSibling);\n                } else {\n                    polyInvoke(this.marker.parentNode).insertBefore(fragment, this.marker.nextElementSibling);\n                }\n            } else {\n                if (polyParent) {\n                    polyInvoke(getPolyParent(this.marker, polyParent)).appendChild(fragment);\n                } else {\n                    polyInvoke(this.marker.parentNode).appendChild(fragment);\n                }\n            }\n        }\n    },\n\n    destory : function(){\n        let count = this.modelBackup.reduce((prev, item) => {\n            let [scopes, bindings] = prev;\n            let scope = this.itemScopeList.get(item);\n            let [scopes_add, bindings_add] = scope.__destroy__(true);\n\n            return [scopes + scopes_add, bindings + bindings_add];\n        }, [0, 0]);\n\n        this.itemScopeList = null;\n        this.itemNodeList = null;\n\n        return count;\n    }\n\n}, Binding).get();\n\nexport default TemplateRepeatBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/TemplateRepeatBinding.js\n **/","import { Make } from '../../util/make.js';\nimport { attributeNames } from './Mapping.js';\nimport { parseExpression, assignExpression } from './Parser.js';\nimport { polyInvoke } from './Util.js';\nimport Binding from './Binding.js';\n\n/**\n * @class TwoWayBinding\n * @extends module:DataBinding.Binding\n * @memberof module:DataBinding\n */\n\nlet TwoWayBinding = Make(/** @lends module:DataBinding.TwoWayBinding# */{\n    /**\n     * @type {string}\n     */\n    currentValue : '',\n\n    /**\n     * @type {Node}\n     */\n    parentNode : null,\n\n    /**\n     * @type {boolean}\n     */\n    indirect : false,\n\n    /**\n     * @type {string}\n     */\n    viewBinding : '',\n\n    update : function(scope){\n        let value = parseExpression(this.properties[0], scope);\n        let attribute = attributeNames.rename(this.node.name);\n\n        if (!this.indirect){\n            polyInvoke(this.parentNode).setAttribute(attribute, value);\n        } else {\n            let oldValue = parseExpression(this.viewBinding, this.parentNode);\n\n            if (value !== oldValue) {\n                assignExpression(this.viewBinding, this.parentNode, value);\n                this.currentValue = value;\n\n                if (document.activeElement === this.parentNode) {\n                    let range = document.createRange();\n                    let selection = window.getSelection();\n                    \n                    range.selectNodeContents(this.parentNode);\n                    range.collapse(false);\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                }\n            }\n        }\n    }\n}, Binding).get();\n\nexport default TwoWayBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/TwoWayBinding.js\n **/","import { Make } from '../../util/make.js';\nimport NetworkRequest from '../../core/prototypes/NetworkRequest.js';\n//import { polyInvoke } from './Util.js';\n\n\n/*let FakeTemplate = {\n    _markup : '',\n    _fragment: null,\n\n    _make : function(markup) {\n        this._markup = markup;\n    },\n\n    get content() {\n        if (!this._fragment) {\n            this._fragment = new DocumentFragment();\n            let container = document.createElement('div');\n\n            polyInvoke(container).innerHTML = this._markup;\n\n            [].forEach.apply(container.childNodes, [element => {\n                polyInvoke(this._fragment).appendChild(element);\n            }]);\n        }\n        return this._fragment;\n    }\n};*/\n\n/**\n * imports a template node from an external HTML file.\n *\n * @function\n * \n * @param {string} source the url of the file that holds the template to import\n * @param {HTMLTemplateElement} template the template element to contain the import\n *\n * @return {HTMLTemplateElement} returns the provided template node, but now holding the imported nodes.\n */\nexport let importTemplate = function(source, template) {\n    let request = Make(NetworkRequest)(source, {});\n\n    return request.send().then(markup => {\n        template.innerHTML = markup;\n\n        return template;\n    });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/TemplateLoader.js\n **/","/**\n * @module NetworkRequest\n */\n\n\n/**\n * removes angulars hashKey property from an object\n *\n * @param {Object} object the object to operate on\n *\n * @return {Object} the initial object\n */\nlet stripHashKey = function(object){\n\tif (Array.isArray(object)) {\n\t\tobject = object.map(stripHashKey);\n\n\t} else {\n\t\tobject = JSON.parse(JSON.stringify(object));\n\n\t\tObject.keys(object).forEach(function(key){\n\t\t\tif (key == '$$hashKey') {\n\t\t\t\tdelete object[key];\n\t\t\t}else if (typeof object[key] === 'object' ) {\n\t\t\t\tobject[key] = stripHashKey(object[key]);\n\t\t\t}\n\t\t});\n\t}\n\n\treturn object;\n}\n\n/**\n * @lends module:NetworkRequest.NetworkRequest#\n */\nlet NetworkRequest = {\n    /**\n     * @private\n     * @type {Object}\n     */\n    _body : {},\n\n    /**\n     * @private\n     * @type {Object}\n     */\n\t_headers : null,\n\n    /**\n     * @type {string}\n     */\n\ttype : '',\n\n    /**\n     * @type {string}\n     */\n\tmethod : '',\n\n    /**\n     * @type {string}\n     */\n\turl : '',\n\n    /**\n     * @type {function[]}\n     * @private\n     */\n    _listeners : null,\n\n\t/**\n\t * The constructor for the NetworkRequest. It simply sets up the properties.\n\t *\n\t * @constructs\n\t *\n\t * @param {string} url the url this request should be made to\n\t * @param {Object} config addintional configuartion for the request\n\t *\n\t * @return {NetworkRequest} the request it self\n\t */\n\t_make : function(url, { method = 'GET', type = 'none' } = {}){\n\t\tthis.type = type;\n\t\tthis.method = method;\n        this._headers = {};\n\t\tthis.url = url;\n        this._listeners = [];\n\t},\n\n\t/**\n\t * this method will set the given object as the request body.\n\t *\n\t * @param {Object} data body data for this request\n\t *\n\t * @return {NetworkRequest} the request it self\n\t */\n\tbody : function(data){\n\t\tthis._body = data;\n\n\t\treturn this;\n\t},\n\n\t/**\n\t * This method will set the request headers, in case custom headers are required.\n\t *\n\t * @param {Object} headers a object with all header properties for this request\n\t *\n\t * @return {NetworkRequest} the request it self\n\t */\n\theaders : function(headers) {\n\t\tthis._headers = headers;\n\n\t\treturn this;\n\t},\n\n    /**\n     * Sets a single header for this request.\n     *\n     * @param {string} key the header key\n     * @param {string} value the header value\n     *\n     * @return {NetworkRequest} the request it self\n     */\n    setHeader : function(key, value) {\n        this._headers[key] = value;\n\n        return this;\n    },\n\n    /**\n     * sets a callback for when the request is ready\n     *\n     * @param {function} fn a callback function as soon as the data is ready\n     *\n     * @return {void}\n     */\n    onReady : function(fn){\n        this._listeners.push(fn);\n    },\n\n\t/**\n\t * This will actually create the network connection and initiate the request.\n\t *\n\t * @return {Promise} resolves when the request is done\n\t */\n\tsend : function(){\n\t\tlet self = this;\n\t\tlet xhr = new XMLHttpRequest();\n\n\t\tif (this.method === 'GET' && this._body) {\n\t\t\tthis.url += '?' + Object.keys(this._body).map(function(key){\n\t\t\t\treturn `${key}=${self._body[key]}`;\n\t\t\t}).join('&');\n\t\t}\n\n\t\txhr.open(this.method, this.url, true);\n\n\t\tlet promise = new Promise((success, failure) => {\n\t\t\txhr.onreadystatechange = () => {\n\t\t\t\tif (xhr.readyState === 4) {\n\t\t\t\t\tif (xhr.status === 200) {\n\t\t\t\t\t\tlet response = xhr.response;\n\n\t\t\t\t\t\tif (xhr.getResponseHeader('Content-Type').indexOf('application/json') > -1 && typeof response  === 'string') {\n                            response = JSON.parse(response);\n\t\t\t\t\t\t}\n\n                        this._listeners.forEach(fn => fn(xhr));\n\n\t\t\t\t\t\tsuccess(response);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfailure(xhr);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\n\t\tObject.keys(this._headers).forEach(function(key){\n\t\t\txhr.setRequestHeader(key, self._headers[key]);\n\t\t});\n\n\t\tif (this.type === 'json') {\n            let body = this._body;\n\n\t\t\txhr.setRequestHeader('Content-Type', 'application/json');\n\n            if (body){\n                body = stripHashKey(body);\n                body = JSON.stringify(body);\n            }\n\n\t\t\txhr.send(body);\n\t\t} else {\n\t\t\txhr.send(this._body);\n\t\t}\n\n\t\treturn promise;\n\t}\n};\n\nexport default NetworkRequest;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/core/prototypes/NetworkRequest.js\n **/","/**\n * @module DataBinding/ViewPort\n */\n\nimport { DataBinding } from '../DataBinding.js';\nimport { Make } from '../../util/make.js';\nimport { polyInvoke } from './Util.js';\nimport RenderEngine from './RenderEngine';\n\nconst LIST_HAS_ITEMS = 0;\n\n/** @lends module:DataBinding/ViewPort.ViewPortInstance# */\nlet ViewPortInstance = {\n\n    /**\n     * @private\n     * @type {module:DataBinding.ScopePrototype}\n     */\n    _scope : null,\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    _bound : false,\n\n    /**\n     * @private\n     * @type {module:DataBinding.ScopePrototype}\n     */\n    _innerScope : null,\n\n    /**\n     * @private\n     * @type {HTMLTemplateElement}\n     */\n    _originalTemplate : null,\n\n    /**\n     * @private\n     * @type {Application}\n     */\n    _application : null,\n\n    /**\n     * @constructs\n     *\n     * @param  {module:DataBinding.ScopePrototype} scope    the scope of this viewport instance\n     * @param  {Application} application the application this viewport instance belongs to\n     *\n     * @return {void}\n     */\n    _make : function(scope, application) {\n        this._scope = scope;\n        this._application = application;\n    },\n\n    /**\n     * binds the ViewPort to a scope so it can be filled with content\n     *\n     * @param  {Object} context a collection of properties to configure the viewport\n     *\n     * @return {Promise.<module:DataBinding/ViewPort.ViewPortInstance>}  promise for when the viewport is bound\n     */\n    bind : function(context) {\n        return new Promise((done, error) => {\n            if (!this._bound) {\n                RenderEngine.schedulePostRenderTask(() => {\n                    this._scope.templateUrl = context.template;\n                    this._scope.overflow = '';\n                    this._scope.__apply__();\n\n                    if (!this._originalTemplate) {\n                        this._originalTemplate = this._scope.element.firstElementChild;\n                    }\n\n                    this._innerScope = DataBinding.makeTemplate(\n                        this._originalTemplate,\n                        context.scope || {},\n                        this._application,\n                        this._scope\n                    );\n\n                    this._bound = true;\n\n                    context.scope = this._innerScope;\n\n                    done(this);\n                });\n            } else {\n                error('ViewPort: viewport is already bound!');\n            }\n        });\n    },\n\n    /**\n     * updates the inner scope of the viewport\n     *\n     * @param  {...*} args arguments to be passed on to {@link module:DataBinding.ScopePrototype#__apply__}\n     *\n     * @return {void}\n     */\n    update : function(...args) {\n        return this._innerScope.__apply__(...args);\n    },\n\n    /**\n     * the scope if ViewPort content\n     *\n     * @type {module:DataBinding.ScopePrototype}\n     */\n    get scope() {\n        return this._innerScope;\n    },\n\n    destory : function(){\n        if (this._bound) {\n            this._innerScope.__destroy__();\n\n            while (this._scope.element.children.length > LIST_HAS_ITEMS) {\n                polyInvoke(this._scope.element).removeChild(this._scope.element.firstChild);\n            }\n\n            polyInvoke(this._scope.element).appendChild(this._originalTemplate);\n            this._bound = false;\n            this._originalTemplate.processed = false;\n        }\n    },\n\n    /**\n     * enables the viewport content to overflow the viewports bounds\n     *\n     * @return {void}\n     */\n    alowOverflow : function() {\n        this._scope.overflow = 'overflow';\n        this._scope.__apply__();\n    },\n};\n\n/**\n * the interface for the ViewPort module\n *\n * @namespace\n * @static\n */\nlet ViewPort = {\n\n    /**\n     * all instanciated ViewPorts\n     *\n     * @private\n     * @type {Map.<module:DataBinding.ScopePrototype>}\n     */\n    _elements : new Map(),\n\n    /**\n     * the applicaion the viewports are registered to\n     *\n     * @private\n     * @type {Application}\n     */\n    _application : null,\n\n    /**\n     * @constructs\n     * @param {Application} application - the application this viewport belongs to.\n     * @return {void}\n     */\n    _make : function(application){\n        let style = polyInvoke(document.head).appendChild(document.createElement('style'));\n        let template = document.createElement('template');\n\n        polyInvoke(style).innerHTML = `\n            .view-port {\n                position: relative;\n                left: 0;\n                top: 0;\n                height: 100%;\n                width: 100%;\n                display: flex;\n                flex-direction: column;\n                overflow: auto;\n            }\n\n            .view-port.overflow {\n                overflow: visible;\n            }\n        `;\n\n        template.id = 'view-port';\n        polyInvoke(template).setAttribute('bind-element', '');\n        polyInvoke(template).setAttribute('component', '');\n\n        polyInvoke(template).innerHTML = `\n            <div class=\"custom-element {{overflow}}\">\n                <template src=\"templateUrl\" replace></template>\n            </div>\n        `;\n\n        application.on('newElement:view-port', (scope) => {\n            this._elements[scope.name] = Make(ViewPortInstance)(scope, application);\n            application.emit(`viewPort:ready:${scope.name}`);\n        });\n\n        this._application = application;\n\n        DataBinding.makeTemplate(template, () => { return {} }, application);\n    },\n\n    /**\n     * fetches a viewPort instance by a name\n     *\n     * @param  {string} name the name to look for\n     *\n     * @return {Promise.<module:DataBinding.ScopePrototype>}  the matching scope\n     */\n    getInstance : function(name){\n        return new Promise((success) => {\n            if (this._elements[name]) {\n                success(this._elements[name]);\n            } else {\n                this._application.on(`viewPort:ready:${name}`, () => success(this._elements[name]));\n            }\n        });\n    },\n\n    /**\n     * destorys an viewPort instance\n     *\n     * @param  {module:DataBinding/ViewPort.ViewPortInstance} instance the instance to destroy\n     *\n     * @return {void}\n     */\n    free : function(instance){\n        this._elements[instance._scope.name] = null;\n\n        instance._scope.__destroy__();\n    }\n};\n\nexport default ViewPort;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/ViewPort.js\n **/","import { Make } from '../../util/make.js';\nimport { parseExpression } from './Parser.js';\nimport Binding from './Binding.js';\nimport BindingRegistry from './BindingRegistry.js';\n\nlet IfBinding = Make(/** @lends module:DataBinding.IfBinding# **/{\n\n    /** @type {string} */\n    name: 'bind-if',\n\n    /**\n     * @type {Node}\n     */\n    parentNode: null,\n\n    /**\n     * @type {Node}\n     */\n    node: null,\n\n    /**\n     * @type {Node}\n     */\n    nextSibling: null,\n\n    /**\n     *\n     * @constructs\n     * @extends {Binding}\n     * @param {Node} parentNode - this node\n     * @param {string} text - the attribute value\n     * @param {ScopeInfo} scopeInfo - bindings container\n     *\n     * @return {void}\n     */\n    _make: function({ parentNode, text, scopeInfo }) {\n        this.node = parentNode;\n        this.parentNode = this.node.parentNode;\n        this.text = text;\n        this.nextSibling = parentNode.nextSibling;\n\n        scopeInfo.bindings.push(this);\n    },\n\n    update: function(scope) {\n        let isTrue = parseExpression(this.text, scope);\n\n        if (isTrue) {\n            if (this.node.parentNode !== this.parentNode){\n                if (this.nextSibling) {\n                    this.parentNode.insertBefore(this.node, this.nextSibling);\n                } else {\n                    this.parentNode.appendChild(this.node);\n                }\n            }\n        } else {\n            if (this.node.parentNode === this.parentNode) {\n                this.parentNode.removeChild(this.node);\n            }\n        }\n    },\n\n}, Binding).get();\n\nBindingRegistry.register(IfBinding);\n\nexport default IfBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/IfBinding.js\n **/","import { Make } from '../../util/make';\nimport { assignExpression, parseExpression } from './Parser';\nimport Binding from './Binding';\nimport BindingRegistry from './BindingRegistry.js';\n\nlet ElementToScopeBinding = Make(/** @lends module:DataBinding.ElementToScopeBinding.prototype */{\n\n    /**\n     * @type {string}\n     */\n    name: 'scope-id',\n\n    /**\n     * @type {Node}\n     */\n    parentNode: null,\n\n    /**\n     * @constructs\n     * @extends {module:DataBinding.Binding}\n     *\n     * @param  {Node} parentNode   parent node of this binding\n     * @param  {Object} scopeInfo  scope metadata object\n     * @param  {string} text       original text value of the binding\n     *\n     * @return {void}\n     */\n    _make: function({parentNode, scopeInfo, text }) {\n        Binding._make.apply(this);\n\n        this.parentNode = parentNode;\n        this.text = text;\n\n        scopeInfo.bindings.push(this);\n\n    },\n\n    update: function(scope) {\n        /** @type {Node} */\n        let currentValue = parseExpression(this.text, scope);\n\n        if (currentValue !== this.parentNode) {\n            assignExpression(this.text, scope, this.parentNode);\n            scope.__apply__(null, true);\n        }\n    },\n\n}, Binding).get();\n\nBindingRegistry.register(ElementToScopeBinding);\n\nexport default ElementToScopeBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/ElementToScopeBinding.js\n **/","import { Make } from '../../util/make.js';\nimport { ObjectParser, parseExpression } from './Parser.js';\nimport Binding from './Binding.js';\nimport BindingRegistry from './BindingRegistry.js';\n\nconst AttributeBinding = Make({\n\n    name: 'bind-attr',\n\n    config: null,\n\n    _make: function({parentNode, scopeInfo, text }) {\n        Binding._make.apply(this);\n\n        this.parentNode = parentNode;\n        this.config = ObjectParser(text);\n\n        scopeInfo.bindings.push(this);\n    },\n\n    update: function(scope) {\n        let attrName = this.config.name;\n        let attrValue = this.config.value ? parseExpression(this.config.value, scope) : '';\n        let attrEnabled = this.config.enabled ? parseExpression(this.config.enabled, scope) : true;\n\n\n        if (attrEnabled) {\n            this.parentNode.setAttribute(attrName, attrValue);\n        } else {\n            this.parentNode.removeAttribute(attrName);\n        }\n    }\n\n}, Binding).get();\n\nBindingRegistry.register(AttributeBinding);\n\nexport default AttributeBinding;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/DataBinding/AttributeBinding.js\n **/","import DataBinding from '../af/modules/DataBinding.js';\nimport ViewController from './ViewController.js';\n\n/** @lends Header# */\nlet Header = {\n    view: null,\n\n    /** @type {application} */\n    application: null,\n\n    _scope: null,\n\n    get notConnected() {\n        /** @type {Socket} */\n        let socket = this.application.socket;\n\n        return !socket.isOnline ||!socket.isConnected;\n    },\n\n    get connected() {\n        let socket = this.application.socket;\n\n        return socket.isOnline && socket.isConnected;\n    },\n\n    get connectionStatus() {\n        let socket = this.application.socket;\n\n        if (!socket.isOnline) {\n            return 'offline';\n        } else if (!socket.isConnected && socket.isConnecting) {\n            return 'connecting...';\n        } else {\n            return 'diconnected';\n        }\n    },\n\n    get partner() {\n        return this.application.account.getPartner();\n    },\n\n    isOnline(online) {\n        return online ? 'online' : 'away';\n    },\n\n    _make: function(application) {\n        this.application = application;\n\n        this._scope = DataBinding.makeTemplate('#header-status', {\n            view: this,\n        }).scope;\n\n        this.application.socket.onStatusChange(this._scope.__apply__);\n        this.subscribe(this.application.account);\n    },\n\n    __proto__: ViewController,\n}\n\nexport default Header;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/Header.js\n **/","\nconst ViewController = {\n\n    subscribe(...models) {\n        models.forEach(model => {\n            model.on('ready', this._scope.__apply__);\n            model.on('change', this._scope.__apply__);\n        });\n    }\n\n};\n\nexport default ViewController;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/ViewController.js\n **/","import DataBinding from '../af/modules/DataBinding.js';\nimport MessageManager from './MessageManager.js';\nimport ViewController from './ViewController.js';\n\nlet MessageList = {\n\n    /** @type module:DataBinding.ScopePrototype */\n    _scope: null,\n\n    get currentMessages() {\n        return MessageManager.messages;\n    },\n\n    _make: function() {\n        this._scope = DataBinding.makeTemplate('#message-list', { view: this }).scope;\n        this.subscribe(MessageManager);\n    },\n\n    __proto__: ViewController,\n};\n\nexport default MessageList;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/MessageList.js\n **/","import CappedArray from './CappedArray.js';\nimport CryptoProxy from './CryptoProxy.js';\nimport EventTarget from '../af/core/prototypes/EventTarget.js';\nimport Message from './Message.js';\nimport Storage from './Storage.js';\n\nconst MessageManager = {\n\n    /** @type {Socket} */\n    _socket: null,\n\n    _loadedMessages: Object.create(CappedArray).constructor(50),\n\n    _account: null,\n\n    _socket: null,\n\n    _mapMessages(chunk) {\n        if (Array.isArray(chunk)) {\n            return chunk.map(message => Object.create(Message).constructor(message, this._account));\n        } else {\n            let stackTrace = null;\n            let name = null;\n\n            try { throw new Error(); } catch (e) { stackTrace = e.stack }\n\n            stackTrace = stackTrace.split('\\n');\n            name = stackTrace.shift();\n\n            console.warn('invalid call of', name, 'at \\n', stackTrace.join('\\n'));\n        }\n    },\n\n    _decryptMessages(chunk) {\n        return Promise.all(chunk.map(message => {\n            return CryptoProxy.decryptMessage(message.body).then(body => {\n                message.body = body;\n                return message;\n            });\n        }));\n    },\n\n    constructor() {\n        super._make();\n\n        this._mapMessages = this._mapMessages.bind(this);\n\n        return this;\n    },\n\n    _getLatestMessageId() {\n        return Storage.getMessages(this._account.partner).then(chunk => (chunk[0] && chunk[0]._id) || 0);\n    },\n\n    _fetchLatestMessages() {\n        this._getLatestMessageId().then(messageId => {\n            return this._socket.sendMessage('account.syncMessages', messageId)\n        })\n        .then(messages => this._decryptMessages(messages.data))\n        .then(chunk => this._mapMessages(chunk))\n        .then(list => {\n            list.forEach(message => {\n                Storage.storeMessage(message.export());\n            });\n\n            this._loadedMessages.push(...list);\n            this.emit('change');\n        });\n    },\n\n    get messages() {\n        return this._loadedMessages.getList();\n    },\n\n\n    _loadLatestMessages() {\n        Storage.getMessages(this._account.partner).then(chunk => {\n            this._loadedMessages.push(...this._mapMessages(chunk.reverse()));\n            this.emit('change');\n        });\n    },\n\n    init(account, socket) {\n        this._account = account;\n        this._socket = socket;\n\n        this._account.on('ready', () => {\n            this._loadLatestMessages();\n        });\n\n        this._socket.on('newTextMessage', () => {\n            this._fetchLatestMessages();\n        });\n\n        this._account.on('authenticated', () => {\n            if (!CryptoProxy.syncRequired) {\n                this._fetchLatestMessages();\n            } else {\n                CryptoProxy.on('ready', () => this._fetchLatestMessages());\n            }\n        });\n    },\n\n    sendMessage(type, content, to) {\n        let message = {\n            from: this._account.id,\n            to: to,\n        };\n\n        if (type === 'text') {\n            return CryptoProxy.encryptMessage(content).then(body => {\n                message.body = body;\n                message.preview = content.substring(0, 15);\n                return this._socket.sendMessage('account.sendTextMessage', message);\n            }).then(result => {\n                console.log(result);\n            })\n\n        }\n    },\n\n    __proto__: EventTarget,\n\n};\n\nwindow.MessageManager = MessageManager;\n\nexport default MessageManager.constructor();\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/MessageManager.js\n **/","\nconst CappedArray = {\n\n    capacity: 0,\n\n    _list: null,\n\n    constructor(capacity = 1000) {\n        this.capacity = capacity;\n        this._list = [];\n\n        return this;\n    },\n\n    push(...elements) {\n        if ((this._list.length + elements.length) > this.capacity) {\n            let overflow = this._list.length + elements - this._list.capacity;\n\n            for (let i = overflow; i > 0; i--) {\n                this._list.sift();\n            }\n        }\n\n        return this._list.push(...elements);\n    },\n\n    getList() {\n        return this._list.slice();\n    }\n};\n\nexport default CappedArray;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/CappedArray.js\n **/","import { Make } from '../af/util/make.js';\nimport { sha256Native } from '../af/modules/sha-256.js';\nimport EventTarget from '../af/core/prototypes/EventTarget';\nimport { hashToBuffer } from '../af/modules/sha-1';\n\nconst bufferToHex = function(buffer) {\n    return buffer.reduce((prev, byte) => prev += ('00' + byte.toString(16)).slice(-2), '');\n}\n\nconst CryptoProxy = Make({\n\n    /** @type {Account} */\n    _account: null,\n\n    /** @type {WebSocket} */\n    _socket: null,\n\n    /** @type {string} */\n    _cryptoKey: null,\n\n    syncing: false,\n    syncRequired: false,\n\n    RAW_CHALLENGE: 'heartwire SyncChallenge solved',\n\n    init: function(account, socket) {\n        this._account = account;\n        this._socket = socket;\n        this._account.on('authenticated', this._checkSync.bind(this));\n\n        this._socket.on('partnerSyncStatus', this._partnerStatusChanged.bind(this));\n    },\n\n    _checkSync: function() {\n        let reason, ready = null;\n\n        if (this.syncing) {\n            this.syncing = false;\n            reason = 'You got disconnected while syncing, please re-try now.';\n        }\n\n        this._cryptoKey = window.localStorage.getItem('heartwire.cryptoKey')\n        ready = !!this._cryptoKey;\n\n        if (!ready) {\n            this.syncRequired = true;\n//            this._account.setSyncChallenge(null);\n            this.emit('syncRequired', reason);\n        } else {\n            this.emit('ready');\n        }\n    },\n\n    _partnerStatusChanged: function({ data: partner }) {\n        if (partner.status === 'ready') {\n            this._solveChallenge(partner.challenge).then(() => {\n                this.syncRequired = false;\n                this.syncing = false;\n\n                window.localStorage.setItem('heartwire.cryptoKey', this._cryptoKey);\n\n                this.emit('syncStatus', 'done');\n                this.emit('ready');\n            }).catch(() => {\n                this.syncing = false;\n                this._cryptoKey = null;\n                this._account.setSyncChallenge(null);\n                this.emit('syncStatus', 'synchronization failed! You need to choose the same passphrase as your partner!');\n            });\n        } else {\n            this.emit('syncStatus', partner.reason);\n        }\n    },\n\n    _readStringToBuffer: function(value) {\n        let bufferView = (new TextEncoder('utf-8')).encode(value);\n\n        return bufferView.buffer;\n    },\n\n    _readStringFromBuffer: function(buffer) {\n        //read message from buffer\n        return (new TextDecoder('utf-8')).decode(buffer);\n    },\n\n    sync: function(passphrase) {\n        this.syncing = true;\n\n        // hash the passphrase\n        sha256Native(btoa(passphrase)).then(key => {\n            this._cryptoKey = key;\n\n            // create a sync challenge for partner\n            return this.encryptMessage(this.RAW_CHALLENGE);\n        }).then(challenge => {\n            return this._account.setSyncChallenge(challenge);\n        }).then(() => {\n            this._socket.sendMessage('partner.getSyncChallenge');\n        });\n    },\n\n    encryptMessage: function(rawMessage) {\n        if (this._cryptoKey) {\n            let iv = crypto.getRandomValues(new Uint8Array(16));\n\n            return window.crypto.subtle.importKey('raw', hashToBuffer(this._cryptoKey), 'AES-CBC', false, ['encrypt', 'decrypt'])\n                .then(key => {\n                    return window.crypto.subtle.encrypt({ name: 'AES-CBC', iv: iv }, key, this._readStringToBuffer(rawMessage));\n                }).then(messageBuffer => {\n                    messageBuffer = new Uint8Array(messageBuffer);\n\n                    let message = bufferToHex(messageBuffer);\n                             iv = bufferToHex(iv);\n\n                    message = btoa(iv + message);\n\n                    return message;\n                }).catch(e => console.log(e));\n        } else {\n            console.error('CryptoProxy:', 'no encrytion key set! unable to encrypt message!');\n            return Promise.reject('no cryptoKey');\n        }\n    },\n\n    _importKey: function(hashedPassphrase) {\n        return window.crypto.subtle.importKey('raw', hashToBuffer(hashedPassphrase), 'AES-CBC', false, ['encrypt', 'decrypt']);\n    },\n\n    decryptMessage: function(messageData) {\n        if (this._cryptoKey) {\n            messageData = atob(messageData);\n\n            // split message data into iv and message parts, then read the hexstring into a buffer.\n            let iv = hashToBuffer(messageData.substring(0, 32));\n            let messageBuffer = hashToBuffer(messageData.substring(32));\n\n            return this._importKey(this._cryptoKey).then(key => {\n                    return window.crypto.subtle.decrypt({name: 'AES-CBC', iv: iv }, key, messageBuffer);\n                }).then(messageBuffer => {\n                    return this._readStringFromBuffer(messageBuffer);\n                }).catch((e) => {\n                    console.log('CryptoProxy:', 'decryption error,', e);\n\n                    return e;\n                });\n        } else {\n            console.error('CryptoProxy:', 'no encryption key set! unable to decrypt message!');\n            return Promise.reject('no cryptoKey');\n        }\n    },\n\n    _solveChallenge: function(challenge) {\n        return this.decryptMessage(challenge).then(message => {\n            if (message === this.RAW_CHALLENGE) {\n                return true;\n            } else {\n                return Promise.reject('wrong key');\n            }\n        })\n    }\n}, EventTarget)();\n\nexport default CryptoProxy;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/CryptoProxy.js\n **/","\n\nlet binaryToHex = function(buffer) {\n    let result = '';\n\n    // choose chunk size\n    if (buffer.length * 8 % 32 === 0) {\n        buffer = new Uint32Array(buffer);\n    } else if (buffer.length * 8 % 16 === 0) {\n        buffer = new Uint16Array(buffer);\n    } else {\n        buffer = new Uint8Array(buffer);\n    }\n\n    buffer.forEach(chunk => {\n        chunk = chunk.toString(16);\n\n        while (chunk.length < (buffer.BYTES_PER_ELEMENT * 2)) {\n            chunk = '0' + chunk;\n        }\n\n        result += chunk;\n    });\n\n    return result;\n}\n\nexport const sha256Native = function(data) {\n    if (typeof data === 'string') {\n        data = (new TextEncoder('utf-8')).encode(data);\n    }\n\n    return window.crypto.subtle.digest('SHA-256', data).then(hashBuffer => {\n        return binaryToHex(hashBuffer);\n    });\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/sha-256.js\n **/","\n/**\n * casts any number to an unsigned 32-bit integer\n *\n * @param  {number} value any numeric value\n *\n * @return {number}       an int32 number\n */\nlet uint32 = function(value) {\n    //cast to integer\n    value = value | 0;\n\n    //make value unsigned\n    value = value >>> 0;\n\n    //limit to 32 bit\n    value = value % Math.pow(2, 32);\n\n    return value;\n}\n\n/**\n * rotates the bits of an uint32 value to the left.\n *\n * @param  {number} value should be uint to prevent unwanted side effects\n * @param  {number} amount the amount of bits to shift <= 32\n *\n * @return {number}       the rotated value already casted to uint32\n */\nlet leftRotateBits = function(value, amount) {\n    value = (value << amount) | (value >>> 32 - amount);\n    value = uint32(value);\n\n    return value;\n}\n\n/**\n * makes sure a hex value is 32-bit long.\n *\n * @param  {string} value a hex string\n *\n * @return {string}       a hex string which is definetely 32-bit long\n */\nlet hex32Bit = function(value) {\n    while (value.length * 4 < 32) {\n        value = '0' + value;\n    }\n\n    return value;\n}\n\n/**\n * makes sure a hex value is 32-bit long.\n *\n * @param  {string} value a hex string\n *\n * @return {string}       a hex string which is definetely 32-bit long\n */\nlet hex64Bit = function(value) {\n    while (value.length * 4 < 64) {\n        value = '0' + value;\n    }\n\n    return value;\n}\n\n/**\n * creates a new array buffer from the utf-8 encoded string.\n *\n * @param  {string} value the original value\n *\n * @return {ArrayBuffer}       the encoded value\n */\nlet stringToBuffer = function(value) {\n    // make sure every character is only 8 bit long\n    value = unescape(encodeURIComponent(value));\n\n    let bufferView = new Uint8Array(value.length);\n\n    // push message into buffer\n    for (let i = 0; i < value.length; i++) {\n        bufferView[i] = value.charCodeAt(i);\n    }\n\n    return bufferView.buffer;\n}\n\n/**\n * the sha-1 algorithm.\n *\n * @param  {(ArrayBuffer|string)} message the message to hash\n *\n * @return {string}         the hex representation of the hash value\n */\nlet sha1 = function(message) {\n\n    if (typeof message === 'string') {\n        message = stringToBuffer(message);\n    }\n\n    // initial values\n    let h0 = 0x67452301;\n    let h1 = 0xEFCDAB89;\n    let h2 = 0x98BADCFE;\n    let h3 = 0x10325476;\n    let h4  = 0xC3D2E1F0;\n\n    let messageLength = message.byteLength;\n    let bufferSize = 0;\n    let buffer = null;\n    let view = null;\n\n    // calculate buffer size. First in bit and then convert to byte.\n    bufferSize = (messageLength + 1) * 8;\n    bufferSize = bufferSize + (448 - (bufferSize % 512)) + 64;\n    bufferSize = bufferSize / 8;\n    buffer = new ArrayBuffer(bufferSize);\n    view = new Uint8Array(buffer);\n\n    //apply data to our local buffer\n    view.set(new Uint8Array(message), 0);\n\n    // append the 1 bit. No idea why this is not just a single bit.\n    view[messageLength] = 0x80;\n\n\n    //reorder bytes\n    for(let i = 0; i < messageLength + 1; i+= 4) {\n        let temp = 0;\n\n        temp = view[i];\n        view[i] = view[i+3];\n        view[i+3] = temp;\n\n        temp = view[i+1];\n        view[i+1] = view[i+2];\n        view[i+2] = temp;\n    }\n\n    //append the message length\n    view = new Uint32Array(buffer);\n    let length = hex64Bit((messageLength * 8).toString(16));\n    view[view.length - 2] = parseInt(length.substring(0, length.length - 8), 16);\n    view[view.length - 1] = parseInt(length.substring(length.length - 8), 16);\n\n    // process each chunk\n    for (let i = 0; i < bufferSize / (512 / 8); i++) {\n        let a = h0;\n        let b = h1;\n        let c = h2;\n        let d = h3;\n        let e = h4;\n        let temp = 0;\n\n        view = new Uint32Array(80);\n        view.set(new Uint32Array(buffer.slice(i * 512, (i + 1 ) * 512)), 0);\n\n        for (let i = 16; i < 80; i++) {\n            view[i] = leftRotateBits(view[i - 3] ^ view[i - 8] ^ view[i - 14] ^ view[i - 16], 1);\n        }\n\n        for (let i = 0; i < 80; i++) {\n            let f = null;\n            let k = null;\n\n            if (i > -1 && i < 20) {\n                f = uint32((b & c) ^ (~b & d))\n                k = 0x5A827999;\n            } else if (i > 19 && i < 40) {\n                f = uint32(b ^ c ^ d);\n                k = 0x6ED9EBA1;\n            } else if (i > 39 && i < 60) {\n                f = uint32((b & c) ^ (b & d) ^ (c & d));\n                k = 0x8F1BBCDC;\n            } else if (i > 59 && i < 80) {\n                f = uint32(b ^ c ^ d);\n                k = 0xCA62C1D6;\n            }\n\n            temp = uint32(leftRotateBits(a, 5) + f + e + k + view[i]);\n            e = uint32(d);\n            d = uint32(c);\n            c = leftRotateBits(b, 30);\n            b = uint32(a)\n            a = uint32(temp);\n        }\n\n        h0 = uint32(h0 + a);\n        h1 = uint32(h1 + b);\n        h2 = uint32(h2 + c);\n        h3 = uint32(h3 + d);\n        h4 = uint32(h4 + e);\n    }\n\n    return hex32Bit(h0.toString(16)) + hex32Bit(h1.toString(16)) + hex32Bit(h2.toString(16)) + hex32Bit(h3.toString(16)) + hex32Bit(h4.toString(16));\n}\n\nexport const hashToBuffer = function(hashString) {\n    let buffer = new Uint8Array(hashString.length / 2);\n\n    hashString.match(/[0-9a-zA-Z]{2}/g).forEach((byte, index) => {\n        buffer[index] = parseInt(byte, 16);\n    })\n\n    return buffer.buffer;\n}\n\nexport default sha1;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/sha-1.js\n **/","\n\nconst Message = {\n    _account: null,\n\n    constructor(data, account) {\n        Object.assign(this, data);\n        this._account = account;\n\n        return this;\n    },\n\n    get inOrOut() {\n        return this._account && (this.from === this._account.id ? 'out' : 'in');\n    },\n\n    export() {\n        return JSON.parse(JSON.stringify(this, (key, value) => {\n            return (key.indexOf('_') !== 0 ||key === '_id') ? value : null;\n        }));\n    }\n};\n\nexport default Message;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/Message.js\n **/","import DataBinding from '../af/modules/DataBinding.js';\n\nconst LoginDialog = {\n\n    /** @type module:DataBinding.ScopePrototype */\n    _scope: null,\n    _account: null,\n\n    get active() {\n        return this._account.busy;\n    },\n\n    /**\n     * [userNameField description]\n     *\n     * @type {HTMLInputElement}\n     */\n    userNameField: null,\n\n    /**\n     * [passwordField description]\n     *\n     * @type {HTMLInputElement}\n     */\n    passwordField: null,\n\n    username: '',\n    password: '',\n\n    get lastError() {\n        return this._account.lastError;\n    },\n\n    get hasError() {\n        return !!this._account.lastError;\n    },\n\n    get isOpen() {\n        return (!this._account.credentialsReady || this.active);\n    },\n\n    get isNotActive(){\n        return !this.active;\n    },\n\n    get isValid() {\n        return this.usernameField.validate() && this.passwordField.validate();\n    },\n\n    _make: function(account){\n        this._scope = DataBinding.makeTemplate('#login-dialog', { view: this }).scope;\n        this._account = account;\n\n        this._account.on('statusChange', this._scope.__apply__.bind(this._scope));\n    },\n\n    login: function() {\n        if (this.view.isValid) {\n            this.view._account.authenticate(this.view.username, this.view.password);\n        }\n    },\n\n    getErrorMessage(element) {\n        element = element.querySelector('input');\n\n        return element.validationMessage;\n    },\n\n    preventDefault: function(event) {\n        event.preventDefault();\n    }\n\n};\n\nexport default LoginDialog;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/LoginDialog.js\n **/","import { Make } from '../af/util/make.js';\n\nlet PushManager = Make(/** @lends PushManager */{\n\n    platform: '',\n\n    serviceStatus: '',\n\n    _newPushHandler: null,\n    _registerHandler: null,\n\n    /**\n     * [_handleServiceError description]\n     *\n     * @callback\n     * @param  {Object} data [description]\n     *\n     * @return {void}      [description]\n     */\n    _handleServiceError: function(data) {\n        this.serviceStatus = 'init failed';\n        console.console.error('push service failed:', data);\n    },\n\n    _baiduHandleServiceReady: function(data) {\n        this._register(data.clientId);\n\n        this.serviceStatus = 'OK';\n        console.log('baidu push is ready', data);\n    },\n\n    _handleMessageError: function(data) {\n        console.error('push message error:', data);\n    },\n\n    _make: function() {\n        if (!!window.cordova && window.cordova.platformId === 'android') {\n            this.platform = 'android';\n        } else if (!!navigator.push) {\n            this.platform = 'firefoxos';\n        }\n\n        this._newPushHandler = [];\n        this._registerHandler = [];\n    },\n\n    _newMessage: function() {\n        this._newPushHandler.forEach(fn => fn());\n    },\n\n    _register: function(token) {\n        this._registerHandler.forEach(fn => fn(token));\n    },\n\n    _registerServiceSimple: function(force) {\n        navigator.push.registrations().onsuccess = function(e) {\n            if (e.target.result.length === 0 && force) {\n                e.target.result.forEach(enpoint => navigator.push.unregister(enpoint));\n\n                let request = navigator.push.register();\n                request.onsuccess = this._simpleHandleServiceReady;\n                request.onerror = this._handleServiceError;\n            }\n        };\n    },\n\n    init: function() {\n        if (this.platform === 'android') {\n            window.baiduPush.startWork('KGQvyGtzWRG6X48cSAwf5Mxk', this._baiduHandleServiceReady.bind(this), this._handleServiceError.bind(this));\n            window.baiduPush.onNotificationArrived(this._newMessage.bind(this), this._handleMessageError.bind(this));\n        } else if (this.platform === 'firefoxos') {\n            this._registerServiceSimple();\n            navigator.mozSetMessageHandler('push', this._newMessage.bind(this));\n            navigator.mozSetMessageHandler('push-register', () => this._registerServiceSimple(true));\n        }\n    },\n\n    onPush: function(fn) {\n        this._newPusHandler.push(fn);\n    },\n\n    onRegister: function(fn) {\n        this._registerHandler.push(fn);\n    },\n\n    setRegistrationFailed: function() {\n        this.serviceStatus = 'unable to register push service';\n    }\n})();\n\nexport default PushManager;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/PushManager.js\n **/","import * as uuid from '../af/modules/uuid.js';\n\n\nlet Socket = {\n\n    _host: '',\n    _hostId: 0,\n\n    /** @type {WebSocket} */\n    _websocket: null,\n    _online: false,\n    _connected: false,\n    _connecting: false,\n    _stop: false,\n    _onStatusChange: null,\n\n    _decelerate: null,\n    _decelerateTimeout: 0,\n    _decelerateMaxTimeout: 30,\n\n    get isConnected() {\n        return this._connected;\n    },\n\n    set isConnected(value) {\n        this._connected = value;\n        this._statusChange();\n    },\n\n    get isConnecting() {\n        return this._connecting;\n    },\n\n    set isConnecting(value) {\n        this._connecting = value;\n        this._statusChange();\n    },\n\n\n    get isOnline() {\n        return this._online;\n    },\n\n    set isOnline(value) {\n        this._online = value;\n        this._statusChange();\n    },\n\n    _make: function({ host }) {\n        this._host = host;\n        this._onceQueue = {};\n        this._listeners = {};\n        this._onStatusChange = [];\n        this._connectedHandler = [];\n\n        this.isOnline = navigator.onLine;\n\n        window.addEventListener('online', () => {\n            this.isOnline = navigator.onLine;\n            console.log('Socket: online');\n            this.init();\n        });\n\n        window.addEventListener('offline', () => {\n            this.isOnline = navigator.onLine;\n            console.log('Socket: offline');\n            this.reconnect();\n        })\n    },\n\n    _ack: function(messageId) {\n        this._websocket.send(JSON.stringify({\n            type: `ack:${messageId}`,\n            id: uuid.v5('0', window.performance.now()),\n        }));\n    },\n\n    _onMessage: function(message) {\n        message = JSON.parse(message.data);\n        console.log('Socket: new message received', message.type, message);\n\n        if (message.type.search('ack') < 0) {\n            this._ack(message.id);\n        }\n\n        if (this._onceQueue[message.type]) {\n            this._onceQueue[message.type].forEach(fn => fn(message));\n            this._onceQueue[message.type] = [];\n        }\n\n        if (this._listeners[message.type]) {\n            this._listeners[message.type].forEach(fn => fn(message));\n        }\n    },\n\n    _statusChange: function() {\n        this._onStatusChange.forEach(fn => fn());\n    },\n\n    _onceQueue: null,\n    _listeners: null,\n    _connectedHandler: null,\n\n    sendMessage: function(type, message) {\n        if (this.isConnected) {\n            let data = {\n                id: uuid.v5('0', window.performance.now().toString()),\n                data: message,\n                type: type,\n            };\n\n            let promise = new Promise((success, failure) => {\n            /**    let timeoutId = setTimeout(() => {\n                    console.warn('Socket: connection timed out! dropping connection!');\n                    this.reconnect();\n                    failure();\n                }, 10000); */\n\n    /**            this.once(`ack:${data.id}`, () => {\n                    clearTimeout(timeoutId);\n                });*/\n\n                this.once(`response:${data.id}`, message => {\n                    success(message);\n                });\n            });\n\n            promise.catch(() => this.reconnect());\n\n            console.log('Socket: message sent', data.type, data);\n            this._websocket.send(JSON.stringify(data));\n\n            return promise;\n        } else {\n            return Promise.reject('disconnected');\n        }\n    },\n\n    reconnect: function() {\n        if (this.isConnected) {\n            this._websocket.close();\n        }\n    },\n\n    init: function() {\n        if (this.isOnline && !this.decelerate && !this._stop) {\n\n            this.isConnecting = true;\n            this._decelerate = setTimeout(() => {\n                console.log('trying to establish a connection...');\n                this._decelerate = null;\n                this._websocket = new WebSocket(this._host[this._hostId], 'hwp-1.0');\n\n                this._websocket.onopen = () => {\n                    this.isConnected = true;\n                    this.isConnecting = false;\n                    this._decelerateTimeout = 0;\n                    console.log('connection established!');\n\n                    this._connectedHandler.forEach(fn => fn());\n                }\n\n                this._websocket.onerror = function(error) {\n                    console.error('websocket error:', error);\n                    this.isConnecting = false;\n                }\n\n                this._websocket.onclose = () => {\n                    // socket closed restart\n                    this._hostId += 1;\n                    this._decelerateTimeout += 1;\n\n                    if (this._hostId > this._host.length - 1) {\n                        this._hostId = 0;\n                    }\n\n                    if (this._decelerateTimeout > this._decelerateMaxTimeout) {\n                        this._decelerateTimeout = this._decelerateMaxTimeout;\n                    }\n\n                    console.warn(`websocket disconnected! Retry in ${this._decelerateTimeout}s to ${this._host[this._hostId]}`);\n                    this.isConnected = false;\n                    this.init();\n                }\n\n                this._websocket.onmessage = this._onMessage.bind(this);\n            }, this._decelerateTimeout * 1000);\n        }\n\n        this._stop = false;\n    },\n\n    once: function(type, fn) {\n        if (!this._onceQueue[type]) {\n            this._onceQueue[type] = [];\n        }\n\n        this._onceQueue[type].push(fn);\n    },\n\n    on: function(type, fn) {\n        if (!this._listeners[type]) {\n            this._listeners[type] = [];\n        }\n\n        this._listeners[type].push(fn);\n    },\n\n    onStatusChange: function(fn) {\n        this._onStatusChange.push(fn);\n    },\n\n    /**\n     * [connected description]\n     *\n     * @param  {Function} fn [description]\n     *\n     * @return {void}      [description]\n     */\n    connected: function(fn) {\n        this._connectedHandler.push(fn);\n    },\n\n    disconnect: function() {\n        this._stop = true;\n        this._websocket.close();\n    }\n};\n\nexport default Socket;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/Socket.js\n **/","import { Make } from '../util/make.js';\nimport sha1 from './sha-1.js';\n\n/**\n * @module Uuid\n */\n\nconst UUID_SIZE = 16; // 16 byte / 128 bit\n\n/** @lends module:Uuid~ReadBytesOfHexString# */\nlet ReadBytesOfHexString = {\n\n    /**\n     * the remaining hex string data\n     *\n     * @type {string}\n     */\n    _value: null,\n\n    /**\n     * [_make description]\n     *\n     * @constructs\n     *\n     * @param  {string} value a hex string\n     *\n     * @return {void}\n     */\n    _make: function(value) {\n        this._value = value;\n    },\n\n    /**\n     * reads the lowest byte from the hex string, expecting bigendian notation.\n     *\n     * @return {number} uint8\n     */\n    readByte: function() {\n        let byte = parseInt(this._value.substring(this._value.length - 2), 16);\n        this._value = this._value.substring(0, this._value.length - 2);\n\n        return byte >>> 0;\n    }\n}\n\nlet hex8Bit = function(value) {\n    while(value.length * 4 < 8) {\n        value = '0' + value;\n    }\n\n    return value;\n}\n\nlet hex16Bit = function(value) {\n    while(value.length * 4 < 16) {\n        value = '0' + value;\n    }\n\n    return value;\n}\n\nlet hex32Bit = function(value) {\n    while(value.length * 4 < 32) {\n        value = '0' + value;\n    }\n\n    return value;\n}\n\nlet hex48Bit = function(value) {\n    while(value.length * 4 < 32) {\n        value = '0' + value;\n    }\n\n    return value;\n}\n\n\nexport let parse = function(uuid) {\n    let index = 0;\n    let buffer = new Uint8Array(UUID_SIZE);\n    let [time_low, time_mid, time_hi_and_version, clock_seq, node] = uuid.split('-');\n\n    let pushToBuffer = function(byte) {\n        buffer[index++] = parseInt(byte, 16);\n    }\n\n    hex32Bit(time_low ||'').match(/.{1,2}/g).reverse().forEach(pushToBuffer);\n    hex16Bit(time_mid ||'').match(/.{1,2}/g).reverse().forEach(pushToBuffer);\n    hex16Bit(time_hi_and_version || '').match(/.{1,2}/g).reverse().forEach(pushToBuffer);\n    hex16Bit(clock_seq || '').match(/.{1,2}/g).reverse().forEach(pushToBuffer);\n    hex48Bit(node ||'').match(/.{1,2}/g).reverse().forEach(pushToBuffer);\n\n    return buffer.buffer;\n}\n\n/**\n * [v5 description]\n *\n * @param  {string} namespace the name space of the new uuid\n * @param  {string} name      the name of the resource of this uuid\n *\n * @return {string}           uuid string\n */\nexport let v5 = function(namespace, name) {\n    let nameValue = new ArrayBuffer(name.length);\n    let namespaceValue = parse(namespace);\n    let completeValue = new Uint8Array(nameValue.byteLength + namespaceValue.byteLength);\n    let uuidBuffer = new Uint8Array(UUID_SIZE);\n    let view = null;\n    let hash = null;\n\n    view = new Uint8Array(nameValue);\n\n    for (let i = 0; i < name.length; i++) {\n        view[i] = name.charCodeAt(i);\n    }\n\n    completeValue.set(new Uint8Array(namespaceValue), 0);\n    completeValue.set(new Uint8Array(nameValue), namespaceValue.byteLength);\n\n    hash = sha1(completeValue.buffer);\n    hash = Make(ReadBytesOfHexString)(hash);\n\n    //time_low (0 - 3)\n    for (let i = 0; i < 4; i++) {\n        uuidBuffer[i] = hash.readByte();\n    }\n\n    // time_mid (4 - 5)\n    for (let i = 4; i < 6; i++) {\n        uuidBuffer[i] = hash.readByte();\n    }\n\n    // time_hi_and_version (6 - 7)\n    for (let i = 6; i < 8; i++) {\n        uuidBuffer[i] = hash.readByte();\n    }\n\n    uuidBuffer[7] = (uuidBuffer[7] & 0x0F) | 0x50;\n\n    // clock_seq_hi_and_reserved (8)\n    uuidBuffer[8] = (hash.readByte() & 0x3F) | 0x80;\n\n    // clock_seq_low (9)\n    uuidBuffer[9] = hash.readByte();\n\n    // node (10 - 15)\n    for (let i = 10; i < 16; i++) {\n        uuidBuffer[i] = hash.readByte();\n    }\n\n    let time_low = hex8Bit(uuidBuffer[3].toString(16)) + hex8Bit(uuidBuffer[2].toString(16)) +\n                   hex8Bit(uuidBuffer[1].toString(16)) + hex8Bit(uuidBuffer[0].toString(16));\n    let time_mid = hex8Bit(uuidBuffer[5].toString(16)) + hex8Bit(uuidBuffer[4].toString(16));\n    let time_hi_and_version = hex8Bit(uuidBuffer[7].toString(16)) + hex8Bit(uuidBuffer[6].toString(16));\n    let clock_seq_hi_and_reserved = hex8Bit(uuidBuffer[8].toString(16));\n    let clock_seq_low = hex8Bit(uuidBuffer[9].toString(16));\n    let node = hex8Bit(uuidBuffer[15].toString(16)) + hex8Bit(uuidBuffer[14].toString(16)) +\n               hex8Bit(uuidBuffer[13].toString(16)) + hex8Bit(uuidBuffer[12].toString(16)) +\n               hex8Bit(uuidBuffer[11].toString(16)) + hex8Bit(uuidBuffer[10].toString(16));\n\n    return `${time_low}-${time_mid}-${time_hi_and_version}-${clock_seq_hi_and_reserved}${clock_seq_low}-${node}`;\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/af/modules/uuid.js\n **/","import CryptoProxy from '../js/CryptoProxy.js';\nimport DataBinding from '../af/modules/DataBinding.js';\n\n\nlet SyncDialog = {\n\n    /** @type {module:DataBinding.ScopePrototype} */\n    _scope: null,\n\n    currentStatus: null,\n    passphrase: '',\n\n    get isOpen() {\n        return CryptoProxy.syncRequired;\n    },\n\n    get busy() {\n        return CryptoProxy.syncing;\n    },\n\n    _make: function() {\n        this._scope = DataBinding.makeTemplate('#sync-dialog', {view: this }).scope;\n\n        CryptoProxy.on('syncRequired', this._syncRequired.bind(this));\n        CryptoProxy.on('syncStatus', this._syncStatusChanged.bind(this));\n    },\n\n    _syncStatusChanged: function(status) {\n        if (status === 'done') {\n            this.currentStatus = null;\n        } else {\n            this.currentStatus = status;\n        }\n\n        this._scope.__apply__();\n    },\n\n    _syncRequired: function(reason) {\n        this.currentStatus = reason;\n\n        this._scope.__apply__();\n    },\n\n    /**\n     * startSync event handler\n     *\n     * @return {void}\n     */\n    startSync: function() {\n        this.view.currentStatus = null;\n        CryptoProxy.sync(this.view.passphrase);\n    },\n\n    not: function(value){\n        return !value;\n    }\n};\n\nexport default SyncDialog;\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/SyncDialog.js\n **/"],"sourceRoot":""}